# Docker ë‚´ë¶€ ë™ì‘ ì›ë¦¬ ì™„ë²½ ë¶„ì„

## ëª©ì°¨
1. [Docker ì•„í‚¤í…ì²˜](#docker-ì•„í‚¤í…ì²˜)
2. [ì´ë¯¸ì§€ ë ˆì´ì–´ ì‹œìŠ¤í…œ](#ì´ë¯¸ì§€-ë ˆì´ì–´-ì‹œìŠ¤í…œ)
3. [ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„](#ì»¨í…Œì´ë„ˆ-ëŸ°íƒ€ì„)
4. [ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ Cgroups](#ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€-cgroups)
5. [Union File System](#union-file-system)
6. [ë„¤íŠ¸ì›Œí‚¹ ì‹¬í™”](#ë„¤íŠ¸ì›Œí‚¹-ì‹¬í™”)
7. [ìŠ¤í† ë¦¬ì§€ ë“œë¼ì´ë²„](#ìŠ¤í† ë¦¬ì§€-ë“œë¼ì´ë²„)

---

## Docker ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
Docker ì „ì²´ ì•„í‚¤í…ì²˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker CLI (Client)                 â”‚
â”‚  $ docker run, build, push, pull, etc.          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ REST API over Unix Socket
                     â”‚ /var/run/docker.sock
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Daemon (dockerd)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         API Server                       â”‚   â”‚
â”‚  â”‚  - REST API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ              â”‚   â”‚
â”‚  â”‚  - ì¸ì¦/ê¶Œí•œ ê´€ë¦¬                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Image Manager                       â”‚   â”‚
â”‚  â”‚  - ì´ë¯¸ì§€ pull/push                      â”‚   â”‚
â”‚  â”‚  - ì´ë¯¸ì§€ ë ˆì´ì–´ ê´€ë¦¬                    â”‚   â”‚
â”‚  â”‚  - ì´ë¯¸ì§€ ë¹Œë“œ                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Container Manager                     â”‚   â”‚
â”‚  â”‚  - ì»¨í…Œì´ë„ˆ ìƒì„±/ì‚­ì œ                    â”‚   â”‚
â”‚  â”‚  - ì»¨í…Œì´ë„ˆ ì‹œì‘/ì¤‘ì§€                    â”‚   â”‚
â”‚  â”‚  - ìƒíƒœ ê´€ë¦¬                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Network Manager                      â”‚   â”‚
â”‚  â”‚  - ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ìƒì„±                    â”‚   â”‚
â”‚  â”‚  - IP ì£¼ì†Œ í• ë‹¹                          â”‚   â”‚
â”‚  â”‚  - í¬íŠ¸ í¬ì›Œë”©                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Volume Manager                       â”‚   â”‚
â”‚  â”‚  - ë³¼ë¥¨ ìƒì„±/ì‚­ì œ                        â”‚   â”‚
â”‚  â”‚  - ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ ê´€ë¦¬                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           containerd (Container Runtime)         â”‚
â”‚  - ê³ ìˆ˜ì¤€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„                        â”‚
â”‚  - ì´ë¯¸ì§€ ì „ì†¡/ì €ì¥                              â”‚
â”‚  - ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸° ê´€ë¦¬                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              runc (OCI Runtime)                  â”‚
â”‚  - ì €ìˆ˜ì¤€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„                        â”‚
â”‚  - ì‹¤ì œ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±                   â”‚
â”‚  - namespace, cgroup ì„¤ì •                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Linux Kernel                          â”‚
â”‚  - Namespaces (ê²©ë¦¬)                             â”‚
â”‚  - Cgroups (ë¦¬ì†ŒìŠ¤ ì œí•œ)                         â”‚
â”‚  - UnionFS (ë ˆì´ì–´ íŒŒì¼ ì‹œìŠ¤í…œ)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ëª…

#### 1. Docker CLI (Client)
```bash
# ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ëª…ë ¹ì–´
$ docker run nginx

# CLIê°€ í•˜ëŠ” ì¼:
# 1. ëª…ë ¹ì–´ íŒŒì‹±
# 2. REST API ìš”ì²­ìœ¼ë¡œ ë³€í™˜
# 3. Unix Socketì„ í†µí•´ Daemonì— ì „ì†¡

# ì‹¤ì œ API í˜¸ì¶œ ì˜ˆì‹œ
POST /v1.41/containers/create
{
  "Image": "nginx",
  "HostConfig": {
    "PortBindings": {
      "80/tcp": [{"HostPort": "8080"}]
    }
  }
}
```

#### 2. Docker Daemon (dockerd)
```
Docker Daemonì˜ ì—­í• :
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. API ìš”ì²­ ì²˜ë¦¬
   - REST API ì—”ë“œí¬ì¸íŠ¸ ì œê³µ
   - ì¸ì¦ ë° ê¶Œí•œ í™•ì¸

2. ì´ë¯¸ì§€ ê´€ë¦¬
   - Docker Hub/Registryì—ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
   - ë¡œì»¬ ì´ë¯¸ì§€ ì €ì¥ì†Œ ê´€ë¦¬
   - Dockerfile ë¹Œë“œ

3. ì»¨í…Œì´ë„ˆ ê´€ë¦¬
   - containerdì—ê²Œ ì»¨í…Œì´ë„ˆ ìƒì„± ìš”ì²­
   - ì»¨í…Œì´ë„ˆ ìƒíƒœ ì¶”ì 

4. ë„¤íŠ¸ì›Œí¬/ë³¼ë¥¨ ê´€ë¦¬
   - ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ìƒì„±
   - ë³¼ë¥¨ ë§ˆìš´íŠ¸
```

#### 3. containerd
```
containerd (ì»¨í…Œì´ë„ˆë””):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ê³ ìˆ˜ì¤€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„

ì—­í• :
âœ“ ì´ë¯¸ì§€ pull/push
âœ“ ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸° ê´€ë¦¬
âœ“ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
âœ“ runc í˜¸ì¶œ

íŠ¹ì§•:
- Dockerì™€ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
- Kubernetesì—ì„œë„ ì‚¬ìš©
- CNCF í”„ë¡œì íŠ¸
```

#### 4. runc
```
runc (ëŸ°ì”¨):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì €ìˆ˜ì¤€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ (OCI í‘œì¤€)

ì—­í• :
âœ“ ì‹¤ì œ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±
âœ“ namespace ì„¤ì •
âœ“ cgroup ì„¤ì •
âœ“ rootfs ë§ˆìš´íŠ¸

ë™ì‘ ê³¼ì •:
1. OCI spec (config.json) ì½ê¸°
2. namespace ìƒì„±
3. cgroup ì„¤ì •
4. íŒŒì¼ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸
5. í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
```

---

## ì´ë¯¸ì§€ ë ˆì´ì–´ ì‹œìŠ¤í…œ

### ë ˆì´ì–´ì˜ ì‘ë™ ì›ë¦¬

```
ì´ë¯¸ì§€ ë ˆì´ì–´ êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Dockerfile:                    ìƒì„±ë˜ëŠ” ë ˆì´ì–´:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FROM ubuntu:20.04              Layer 1: Ubuntu base
                               (sha256:abc123...)
                               í¬ê¸°: 72.8 MB
                               ì½ê¸° ì „ìš© âœ“
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RUN apt-get update             Layer 2: apt update
                               (sha256:def456...)
                               í¬ê¸°: 42.3 MB
                               ì½ê¸° ì „ìš© âœ“
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RUN apt-get install -y nginx   Layer 3: nginx install
                               (sha256:ghi789...)
                               í¬ê¸°: 54.1 MB
                               ì½ê¸° ì „ìš© âœ“
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

COPY app.js /app/              Layer 4: app code
                               (sha256:jkl012...)
                               í¬ê¸°: 2.4 KB
                               ì½ê¸° ì „ìš© âœ“
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RUN npm install                Layer 5: dependencies
                               (sha256:mno345...)
                               í¬ê¸°: 125.6 MB
                               ì½ê¸° ì „ìš© âœ“
                               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ:             Container Layer:
                               (ì„ì‹œ)
                               í¬ê¸°: 0 KB â†’ ì¦ê°€
                               ì½ê¸°/ì“°ê¸° âœ“
                               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ì´ ì´ë¯¸ì§€ í¬ê¸°: 297.2 MB
```

### Copy-on-Write (CoW) ë©”ì»¤ë‹ˆì¦˜

```
Copy-on-Write ë™ì‘ ê³¼ì •:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì‹œë‚˜ë¦¬ì˜¤: ì»¨í…Œì´ë„ˆì—ì„œ /etc/nginx/nginx.conf íŒŒì¼ ìˆ˜ì •

1. íŒŒì¼ ì½ê¸° (Read)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Container Layer     â”‚  â† íŒŒì¼ ì—†ìŒ
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 5             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 4             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 3             â”‚  â† nginx.conf ë°œê²¬!
   â”‚  /etc/nginx/nginx.confâ”‚  (ì½ê¸° ì „ìš©)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â†’ í•˜ìœ„ ë ˆì´ì–´ì—ì„œ íŒŒì¼ ì°¾ì•„ì„œ ì½ê¸° âœ“

2. íŒŒì¼ ì“°ê¸° (Write)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Container Layer     â”‚
   â”‚  /etc/nginx/nginx.confâ”‚  â† ë³µì‚¬ë³¸ ìƒì„±!
   â”‚  (ìˆ˜ì •ëœ ë²„ì „)        â”‚  (ì½ê¸°/ì“°ê¸°)
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 5             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 4             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚  Layer 3             â”‚
   â”‚  /etc/nginx/nginx.confâ”‚  â† ì›ë³¸ (ì½ê¸° ì „ìš©)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â†’ íŒŒì¼ì„ Container Layerë¡œ ë³µì‚¬ í›„ ìˆ˜ì • âœ“
   â†’ ì›ë³¸ ë ˆì´ì–´ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ âœ“

3. ì´í›„ ì½ê¸°
   â†’ Container Layerì˜ ìˆ˜ì •ëœ íŒŒì¼ ì‚¬ìš©
   â†’ í•˜ìœ„ ë ˆì´ì–´ì˜ ì›ë³¸ì€ ìˆ¨ê²¨ì§
```

### ë ˆì´ì–´ ê³µìœ ì˜ íš¨ìœ¨ì„±

```
ë ˆì´ì–´ ê³µìœ  ì˜ˆì‹œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

3ê°œì˜ Node.js ì•± ì´ë¯¸ì§€:

Image A:                    Image B:                    Image C:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App A (1MB)  â”‚           â”‚ App B (2MB)  â”‚           â”‚ App C (1.5MB)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ npm deps     â”‚           â”‚ npm deps     â”‚           â”‚ npm deps     â”‚
â”‚ (200MB)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (200MB)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (200MB)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   ê³µìœ     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   ê³µìœ     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Node.js      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Node.js      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Node.js      â”‚
â”‚ (150MB)      â”‚   ê³µìœ     â”‚ (150MB)      â”‚   ê³µìœ     â”‚ (150MB)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ubuntu       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Ubuntu       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Ubuntu       â”‚
â”‚ (100MB)      â”‚   ê³µìœ     â”‚ (100MB)      â”‚   ê³µìœ     â”‚ (100MB)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë ˆì´ì–´ ê³µìœ  X (ì „í†µì  ë°©ì‹):
100 + 150 + 200 + 1  = 451 MB
100 + 150 + 200 + 2  = 452 MB
100 + 150 + 200 + 1.5 = 451.5 MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´: 1,354.5 MB

ë ˆì´ì–´ ê³µìœ  O (Docker):
100 + 150 + 200 = 450 MB (ê³µìœ  ë ˆì´ì–´)
1 + 2 + 1.5 = 4.5 MB (ê° ì•±)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´: 454.5 MB

ì ˆì•½: 900 MB (66% ê°ì†Œ!)
```

### ì´ë¯¸ì§€ ë ˆì´ì–´ ìµœì í™”

```dockerfile
# âŒ ë¹„íš¨ìœ¨ì ì¸ Dockerfile
FROM node:18
COPY . .                    # ëª¨ë“  íŒŒì¼ ë³µì‚¬ (ë ˆì´ì–´ ìºì‹± ì•ˆ ë¨)
RUN npm install             # ì†ŒìŠ¤ ë³€ê²½ ì‹œë§ˆë‹¤ ì¬ì„¤ì¹˜
CMD ["node", "server.js"]

# ë¬¸ì œ:
# - ì†ŒìŠ¤ ì½”ë“œ í•œ ì¤„ë§Œ ë°”ê¿”ë„
# - npm install ë‹¤ì‹œ ì‹¤í–‰ (5ë¶„ ì†Œìš”)

# âœ… íš¨ìœ¨ì ì¸ Dockerfile
FROM node:18

WORKDIR /app

# 1. package.jsonë§Œ ë¨¼ì € ë³µì‚¬
COPY package*.json ./       # Layer 1: ì˜ì¡´ì„± ì •ì˜
RUN npm install             # Layer 2: ì˜ì¡´ì„± ì„¤ì¹˜ (ìºì‹±ë¨!)

# 2. ì†ŒìŠ¤ ì½”ë“œëŠ” ë‚˜ì¤‘ì— ë³µì‚¬
COPY . .                    # Layer 3: ì†ŒìŠ¤ ì½”ë“œ

CMD ["node", "server.js"]

# ì¥ì :
# - package.json ë³€ê²½ ì—†ìœ¼ë©´
# - npm install ìºì‹œ ì‚¬ìš© (10ì´ˆë¡œ ë‹¨ì¶•)
```

```
ë¹Œë“œ ìºì‹œ ë™ì‘:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì²« ë²ˆì§¸ ë¹Œë“œ:
Step 1: FROM node:18          âœ“ (ìºì‹œ ì—†ìŒ, ë‹¤ìš´ë¡œë“œ)
Step 2: COPY package.json     âœ“ (ìºì‹œ ì—†ìŒ, ë³µì‚¬)
Step 3: RUN npm install       âœ“ (ìºì‹œ ì—†ìŒ, 5ë¶„ ì†Œìš”)
Step 4: COPY . .              âœ“ (ìºì‹œ ì—†ìŒ, ë³µì‚¬)
ì´ ì†Œìš” ì‹œê°„: 5ë¶„ 30ì´ˆ

ì†ŒìŠ¤ ì½”ë“œ ìˆ˜ì • í›„ ë‘ ë²ˆì§¸ ë¹Œë“œ:
Step 1: FROM node:18          âœ“ (ìºì‹œ ì‚¬ìš©)
Step 2: COPY package.json     âœ“ (ìºì‹œ ì‚¬ìš©, íŒŒì¼ ë™ì¼)
Step 3: RUN npm install       âœ“ (ìºì‹œ ì‚¬ìš©!)
Step 4: COPY . .              âœ“ (ìºì‹œ ë¬´íš¨í™”, ì¬ë³µì‚¬)
ì´ ì†Œìš” ì‹œê°„: 10ì´ˆ

package.json ìˆ˜ì • í›„ ë¹Œë“œ:
Step 1: FROM node:18          âœ“ (ìºì‹œ ì‚¬ìš©)
Step 2: COPY package.json     âœ“ (ìºì‹œ ë¬´íš¨í™”, ì¬ë³µì‚¬)
Step 3: RUN npm install       âœ“ (ìºì‹œ ë¬´íš¨í™”, ì¬ì‹¤í–‰, 5ë¶„)
Step 4: COPY . .              âœ“ (ìºì‹œ ë¬´íš¨í™”, ì¬ë³µì‚¬)
ì´ ì†Œìš” ì‹œê°„: 5ë¶„ 10ì´ˆ
```

---

## ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„

### ì»¨í…Œì´ë„ˆ ìƒì„± ê³¼ì •

```
docker run nginx:latest ëª…ë ¹ ì‹¤í–‰ ì‹œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Docker CLI
   $ docker run nginx:latest
   â†“
   POST /containers/create {"Image": "nginx:latest"}

2. Docker Daemon
   â†“
   â‘  ì´ë¯¸ì§€ í™•ì¸
      - ë¡œì»¬ì— nginx:latest ìˆëŠ”ì§€ í™•ì¸
      - ì—†ìœ¼ë©´ Docker Hubì—ì„œ pull
   â†“
   â‘¡ containerdì—ê²Œ ìš”ì²­
      "nginx:latestë¡œ ì»¨í…Œì´ë„ˆ ë§Œë“¤ì–´ì¤˜"

3. containerd
   â†“
   â‘  ì´ë¯¸ì§€ ë ˆì´ì–´ ì¤€ë¹„
      - Layer 1: base OS
      - Layer 2: nginx
      - Layer 3: config
   â†“
   â‘¡ runcì—ê²Œ ìš”ì²­
      "ì´ OCI specìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰í•´ì¤˜"

4. runc
   â†“
   â‘  Namespace ìƒì„±
      - PID namespace
      - Network namespace
      - Mount namespace
      - UTS namespace
      - IPC namespace
   â†“
   â‘¡ cgroup ì„¤ì •
      - CPU ì œí•œ
      - Memory ì œí•œ
      - Disk I/O ì œí•œ
   â†“
   â‘¢ rootfs ë§ˆìš´íŠ¸
      - ì´ë¯¸ì§€ ë ˆì´ì–´ë“¤ì„ overlay
      - Container layer ì¶”ê°€
   â†“
   â‘£ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
      - nginx í”„ë¡œì„¸ìŠ¤ ì‹œì‘
      - PID 1ë¡œ ì‹¤í–‰

5. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì™„ë£Œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Container             â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚  â”‚  PID 1: nginx    â”‚ â”‚
   â”‚  â”‚  PID 2: worker   â”‚ â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â”‚                        â”‚
   â”‚  Network: 172.17.0.2   â”‚
   â”‚  Memory: 512MB limit   â”‚
   â”‚  CPU: 1 core           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OCI Runtime Specification

```json
// config.json (OCI Spec)
{
  "ociVersion": "1.0.0",
  "process": {
    "terminal": false,
    "user": {
      "uid": 0,
      "gid": 0
    },
    "args": [
      "nginx",
      "-g",
      "daemon off;"
    ],
    "env": [
      "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
      "NGINX_VERSION=1.21.0"
    ],
    "cwd": "/",
    "rlimits": [
      {
        "type": "RLIMIT_NOFILE",
        "hard": 1024,
        "soft": 1024
      }
    ]
  },
  "root": {
    "path": "rootfs",
    "readonly": true
  },
  "hostname": "nginx-container",
  "mounts": [
    {
      "destination": "/proc",
      "type": "proc",
      "source": "proc"
    },
    {
      "destination": "/dev",
      "type": "tmpfs",
      "source": "tmpfs"
    }
  ],
  "linux": {
    "namespaces": [
      {
        "type": "pid"
      },
      {
        "type": "network"
      },
      {
        "type": "mount"
      },
      {
        "type": "ipc"
      },
      {
        "type": "uts"
      }
    ],
    "resources": {
      "memory": {
        "limit": 536870912
      },
      "cpu": {
        "shares": 1024,
        "quota": 100000,
        "period": 100000
      }
    }
  }
}
```

---

## ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ Cgroups

### Namespace ìƒì„¸

#### 1. PID Namespace

```bash
# í˜¸ìŠ¤íŠ¸ì—ì„œ ë³´ëŠ” í”„ë¡œì„¸ìŠ¤
$ ps aux
USER  PID   COMMAND
root  1     /sbin/init
root  100   nginx
root  101   nginx worker
root  200   python app.py

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ë³´ëŠ” í”„ë¡œì„¸ìŠ¤
$ docker exec mycontainer ps aux
USER  PID   COMMAND
root  1     nginx              â† í˜¸ìŠ¤íŠ¸ì—ì„œëŠ” PID 100
root  2     nginx worker       â† í˜¸ìŠ¤íŠ¸ì—ì„œëŠ” PID 101

â†’ ê° ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ì ì¸ PID ë„¤ì„ìŠ¤í˜ì´ìŠ¤
â†’ ì»¨í…Œì´ë„ˆ ë‚´ë¶€: PID 1ë¶€í„° ì‹œì‘
â†’ í˜¸ìŠ¤íŠ¸: ë‹¤ë¥¸ PIDë¡œ ë³´ì„
```

```
PID Namespace ê³„ì¸µ êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Host PID Namespace
â”œâ”€ PID 1: /sbin/init
â”œâ”€ PID 100: dockerd
â”œâ”€ PID 200: containerd
â””â”€ PID 300: runc
   â”‚
   â””â”€ Container A PID Namespace
      â”œâ”€ PID 1: nginx (í˜¸ìŠ¤íŠ¸ì—ì„œ PID 400)
      â””â”€ PID 2: worker (í˜¸ìŠ¤íŠ¸ì—ì„œ PID 401)

   â””â”€ Container B PID Namespace
      â”œâ”€ PID 1: python (í˜¸ìŠ¤íŠ¸ì—ì„œ PID 500)
      â””â”€ PID 2: gunicorn (í˜¸ìŠ¤íŠ¸ì—ì„œ PID 501)
```

#### 2. Network Namespace

```bash
# í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤
$ ip addr
1: lo: <LOOPBACK,UP> ...
2: eth0: <BROADCAST,MULTICAST,UP> 192.168.1.100
3: docker0: <BROADCAST,MULTICAST,UP> 172.17.0.1

# ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤
$ docker exec mycontainer ip addr
1: lo: <LOOPBACK,UP> ...           â† ë…ë¦½ì ì¸ loopback
2: eth0: <BROADCAST,MULTICAST,UP> 172.17.0.2  â† ê°€ìƒ ì¸í„°í˜ì´ìŠ¤

â†’ ê° ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ì ì¸ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ
â†’ ìì²´ IP, ë¼ìš°íŒ… í…Œì´ë¸”, ë°©í™”ë²½ ê·œì¹™
```

```
Network Namespace êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Host Network Namespace
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  eth0: 192.168.1.100                â”‚
â”‚  docker0: 172.17.0.1 (bridge)       â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€veth1â”€â”€â”      â”Œâ”€â”€veth2â”€â”€â”     â”‚
â””â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”˜
   â”‚         â”‚      â”‚         â”‚
   â”‚  eth0   â”‚      â”‚  eth0   â”‚
   â”‚  172    â”‚      â”‚  172    â”‚
   â”‚  .17    â”‚      â”‚  .17    â”‚
   â”‚  .0.2   â”‚      â”‚  .0.3   â”‚
   â”‚         â”‚      â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Container A      Container B
   Network NS       Network NS
```

#### 3. Mount Namespace

```bash
# í˜¸ìŠ¤íŠ¸ ë§ˆìš´íŠ¸
$ mount
/dev/sda1 on / type ext4
/dev/sdb1 on /data type ext4

# ì»¨í…Œì´ë„ˆ ë§ˆìš´íŠ¸
$ docker exec mycontainer mount
overlay on / type overlay          â† Union FS
tmpfs on /dev type tmpfs
/dev/sda1 on /data type ext4       â† í˜¸ìŠ¤íŠ¸ ë³¼ë¥¨ ë§ˆìš´íŠ¸

â†’ ê° ì»¨í…Œì´ë„ˆëŠ” ë…ë¦½ì ì¸ íŒŒì¼ì‹œìŠ¤í…œ
â†’ í˜¸ìŠ¤íŠ¸ì™€ ë‹¤ë¥¸ ë§ˆìš´íŠ¸ í¬ì¸íŠ¸
```

### Cgroups ìƒì„¸

```
Cgroups ê³„ì¸µ êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

/sys/fs/cgroup/
â”œâ”€â”€ cpu/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ <container-id-1>/
â”‚   â”‚   â”‚   â”œâ”€â”€ cpu.shares = 1024
â”‚   â”‚   â”‚   â”œâ”€â”€ cpu.cfs_quota_us = 50000
â”‚   â”‚   â”‚   â””â”€â”€ cpu.cfs_period_us = 100000
â”‚   â”‚   â””â”€â”€ <container-id-2>/
â”‚   â”‚       â””â”€â”€ cpu.shares = 2048
â”‚   â””â”€â”€ ...
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ <container-id-1>/
â”‚   â”‚   â”‚   â”œâ”€â”€ memory.limit_in_bytes = 536870912 (512MB)
â”‚   â”‚   â”‚   â””â”€â”€ memory.oom_control = 1
â”‚   â”‚   â””â”€â”€ <container-id-2>/
â”‚   â”‚       â””â”€â”€ memory.limit_in_bytes = 1073741824 (1GB)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ blkio/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â””â”€â”€ <container-id-1>/
â”‚   â”‚       â”œâ”€â”€ blkio.throttle.read_bps_device = 1048576 (1MB/s)
â”‚   â”‚       â””â”€â”€ blkio.throttle.write_bps_device = 1048576 (1MB/s)
â”‚   â””â”€â”€ ...
â””â”€â”€ net_cls/
    â””â”€â”€ docker/
        â””â”€â”€ <container-id-1>/
            â””â”€â”€ net_cls.classid = 0x100001
```

#### CPU ì œì–´

```bash
# CPU ì œí•œ ì„¤ì •
$ docker run -d \
  --cpus="1.5" \              # 1.5 ì½”ì–´
  --cpu-shares=1024 \         # CPU ê°€ì¤‘ì¹˜
  nginx

# ë‚´ë¶€ ë™ì‘:
/sys/fs/cgroup/cpu/docker/<container-id>/cpu.cfs_quota_us = 150000
/sys/fs/cgroup/cpu/docker/<container-id>/cpu.cfs_period_us = 100000
/sys/fs/cgroup/cpu/docker/<container-id>/cpu.shares = 1024

# ê³„ì‚°:
# CPU ì‚¬ìš©ë¥  = quota / period = 150000 / 100000 = 1.5 ì½”ì–´
```

```
CPU ê°€ì¤‘ì¹˜ (cpu.shares) ë™ì‘:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì‹œë‚˜ë¦¬ì˜¤: CPU 2ì½”ì–´, ì»¨í…Œì´ë„ˆ 3ê°œ

Container A: --cpu-shares=1024
Container B: --cpu-shares=2048  (2ë°°)
Container C: --cpu-shares=512   (0.5ë°°)

CPU ê²½í•© ì—†ì„ ë•Œ:
A: 2 ì½”ì–´ ì‚¬ìš© ê°€ëŠ¥
B: 2 ì½”ì–´ ì‚¬ìš© ê°€ëŠ¥
C: 2 ì½”ì–´ ì‚¬ìš© ê°€ëŠ¥

CPU ê²½í•© ë°œìƒ ì‹œ (ëª¨ë‘ 100% ì‚¬ìš© ì‹œë„):
ì´ ê°€ì¤‘ì¹˜ = 1024 + 2048 + 512 = 3584

A: 2 Ã— (1024/3584) = 0.57 ì½”ì–´
B: 2 Ã— (2048/3584) = 1.14 ì½”ì–´  â† 2ë°°
C: 2 Ã— (512/3584) = 0.29 ì½”ì–´   â† 0.5ë°°
```

#### Memory ì œì–´

```bash
# ë©”ëª¨ë¦¬ ì œí•œ ì„¤ì •
$ docker run -d \
  --memory="512m" \           # ë©”ëª¨ë¦¬ ì œí•œ
  --memory-swap="1g" \        # ë©”ëª¨ë¦¬ + Swap ì œí•œ
  --memory-reservation="256m" \  # ì†Œí”„íŠ¸ ì œí•œ
  --oom-kill-disable \        # OOM Killer ë¹„í™œì„±í™”
  nginx

# ë‚´ë¶€ ë™ì‘:
/sys/fs/cgroup/memory/docker/<container-id>/memory.limit_in_bytes = 536870912
/sys/fs/cgroup/memory/docker/<container-id>/memory.memsw.limit_in_bytes = 1073741824
/sys/fs/cgroup/memory/docker/<container-id>/memory.soft_limit_in_bytes = 268435456
```

```
ë©”ëª¨ë¦¬ ì œí•œ ë™ì‘:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€:

0 MB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚
     â”‚ ì •ìƒ ë™ì‘
     â”‚
256 MB (soft limit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚ âš ï¸ ê²½ê³ : ë©”ëª¨ë¦¬ íšŒìˆ˜ ì‹œë„
     â”‚ (ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ)
     â”‚
512 MB (hard limit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚ ğŸš« ë” ì´ìƒ í• ë‹¹ ë¶ˆê°€
     â”‚ â‘  OOM Killer í™œì„±í™”: í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ
     â”‚ â‘¡ OOM Killer ë¹„í™œì„±í™”: í• ë‹¹ ì‹¤íŒ¨ (malloc ì‹¤íŒ¨)
     â”‚
1 GB (swap limit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚ ğŸš« Swapê¹Œì§€ ì´ˆê³¼
     â”‚ í”„ë¡œì„¸ìŠ¤ ê°•ì œ ì¢…ë£Œ
```

#### Disk I/O ì œì–´

```bash
# Disk I/O ì œí•œ
$ docker run -d \
  --device-read-bps /dev/sda:1mb \    # ì½ê¸°: 1MB/s
  --device-write-bps /dev/sda:1mb \   # ì“°ê¸°: 1MB/s
  --device-read-iops /dev/sda:100 \   # ì½ê¸°: 100 IOPS
  --device-write-iops /dev/sda:100 \  # ì“°ê¸°: 100 IOPS
  nginx
```

---

## Union File System

### OverlayFS ë™ì‘ ì›ë¦¬

```
OverlayFS êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

                    Merged View (ì»¨í…Œì´ë„ˆì—ì„œ ë³´ì´ëŠ” ê²ƒ)
                    /merged
                    â”œâ”€â”€ bin/
                    â”œâ”€â”€ etc/
                    â”‚   â””â”€â”€ nginx/
                    â”‚       â””â”€â”€ nginx.conf  (ìˆ˜ì •ë¨)
                    â”œâ”€â”€ usr/
                    â””â”€â”€ app/
                        â””â”€â”€ index.html
                            â†‘
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚
          Upper (ì½ê¸°/ì“°ê¸°)    Lower (ì½ê¸° ì „ìš©)
          /var/lib/docker/     /var/lib/docker/
          overlay2/<id>/       overlay2/l/
          upper/               <layer-id>/
          â”œâ”€â”€ etc/             â”œâ”€â”€ bin/
          â”‚   â””â”€â”€ nginx/       â”œâ”€â”€ etc/
          â”‚       â””â”€â”€ nginx.conf (ìˆ˜ì •ë³¸)  â”‚   â””â”€â”€ nginx/
          â””â”€â”€ app/             â”‚       â””â”€â”€ nginx.conf (ì›ë³¸)
              â””â”€â”€ index.html   â””â”€â”€ usr/
```

### íŒŒì¼ ì—°ì‚° ë™ì‘

```
1. íŒŒì¼ ì½ê¸° (Read):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

$ cat /etc/nginx/nginx.conf

ê³¼ì •:
â‘  Upper layer í™•ì¸
   â†’ /var/lib/docker/overlay2/<id>/upper/etc/nginx/nginx.conf
   â†’ ì—†ìŒ

â‘¡ Lower layer í™•ì¸
   â†’ /var/lib/docker/overlay2/l/<layer>/etc/nginx/nginx.conf
   â†’ ë°œê²¬! âœ“

â‘¢ íŒŒì¼ ë‚´ìš© ë°˜í™˜


2. íŒŒì¼ ì“°ê¸° (Write):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

$ echo "new config" > /etc/nginx/nginx.conf

ê³¼ì •:
â‘  Upper layer í™•ì¸
   â†’ íŒŒì¼ ì—†ìŒ

â‘¡ Lower layerì—ì„œ íŒŒì¼ ë³µì‚¬
   Lower â†’ Upper
   (Copy-on-Write)

â‘¢ Upper layerì˜ ë³µì‚¬ë³¸ ìˆ˜ì •
   â†’ /var/lib/docker/overlay2/<id>/upper/etc/nginx/nginx.conf

â‘£ ì´í›„ ì½ê¸°ëŠ” Upper layerì˜ íŒŒì¼ ì‚¬ìš©


3. íŒŒì¼ ì‚­ì œ (Delete):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

$ rm /etc/nginx/nginx.conf

ê³¼ì •:
â‘  Upper layerì— "whiteout" íŒŒì¼ ìƒì„±
   â†’ .wh.nginx.conf

â‘¡ Merged viewì—ì„œ íŒŒì¼ ìˆ¨ê¹€
   (ì‹¤ì œ Lower layer íŒŒì¼ì€ ê·¸ëŒ€ë¡œ)

â‘¢ ì»¨í…Œì´ë„ˆì—ì„œëŠ” íŒŒì¼ì´ ì‚­ì œëœ ê²ƒì²˜ëŸ¼ ë³´ì„


4. ë””ë ‰í† ë¦¬ ìƒì„± (Create):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

$ mkdir /app/data

ê³¼ì •:
â‘  Upper layerì— ë””ë ‰í† ë¦¬ ìƒì„±
   â†’ /var/lib/docker/overlay2/<id>/upper/app/data

â‘¡ Merged viewì— ì¦‰ì‹œ ë°˜ì˜
```

### ì‹¤ì œ ë ˆì´ì–´ í™•ì¸

```bash
# ì»¨í…Œì´ë„ˆì˜ ë ˆì´ì–´ êµ¬ì¡° í™•ì¸
$ docker inspect nginx | grep -A 50 GraphDriver

{
  "GraphDriver": {
    "Data": {
      "LowerDir": "/var/lib/docker/overlay2/abc123.../diff:/var/lib/docker/overlay2/def456.../diff:/var/lib/docker/overlay2/ghi789.../diff",
      "MergedDir": "/var/lib/docker/overlay2/merged",
      "UpperDir": "/var/lib/docker/overlay2/upper",
      "WorkDir": "/var/lib/docker/overlay2/work"
    },
    "Name": "overlay2"
  }
}

# ì‹¤ì œ íŒŒì¼ êµ¬ì¡°
/var/lib/docker/overlay2/
â”œâ”€â”€ abc123.../            # Layer 1 (base)
â”‚   â””â”€â”€ diff/
â”‚       â”œâ”€â”€ bin/
â”‚       â”œâ”€â”€ etc/
â”‚       â””â”€â”€ usr/
â”œâ”€â”€ def456.../            # Layer 2 (nginx)
â”‚   â””â”€â”€ diff/
â”‚       â””â”€â”€ etc/
â”‚           â””â”€â”€ nginx/
â”œâ”€â”€ ghi789.../            # Layer 3 (config)
â”‚   â””â”€â”€ diff/
â”‚       â””â”€â”€ etc/
â”‚           â””â”€â”€ nginx/
â”‚               â””â”€â”€ nginx.conf
â””â”€â”€ <container-id>/       # Container layer
    â”œâ”€â”€ upper/            # ì“°ê¸° ê°€ëŠ¥ ë ˆì´ì–´
    â”œâ”€â”€ work/             # OverlayFS ì‘ì—… ë””ë ‰í† ë¦¬
    â””â”€â”€ merged/           # ìµœì¢… í†µí•© ë·°
```

---

## ë„¤íŠ¸ì›Œí‚¹ ì‹¬í™”

### ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ

#### 1. Bridge ëª¨ë“œ (ê¸°ë³¸ê°’)

```
Bridge ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Host Network
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  eth0: 192.168.1.100                        â”‚
â”‚                                             â”‚
â”‚  docker0 (bridge): 172.17.0.1               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              â”‚                 â”‚        â”‚
â”‚  â”‚  veth123     â”‚  veth456        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚              â”‚                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚Container1â”‚   â”‚Container2â”‚            â”‚
â”‚    â”‚          â”‚   â”‚          â”‚            â”‚
â”‚    â”‚eth0:     â”‚   â”‚eth0:     â”‚            â”‚
â”‚    â”‚172.17.0.2â”‚   â”‚172.17.0.3â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í†µì‹  íë¦„:

1. Container1 â†’ Container2:
   172.17.0.2 â†’ 172.17.0.3
   veth123 â†’ docker0 â†’ veth456
   (ê°™ì€ bridge, ì§ì ‘ í†µì‹ )

2. Container1 â†’ ì™¸ë¶€ (8.8.8.8):
   172.17.0.2 â†’ 8.8.8.8
   veth123 â†’ docker0 â†’ NAT â†’ eth0 â†’ Internet
   (NAT í†µí•´ ì™¸ë¶€ í†µì‹ )

3. ì™¸ë¶€ â†’ Container1 (í¬íŠ¸ 8080):
   192.168.1.100:8080 â†’ 172.17.0.2:80
   eth0 â†’ DNAT (í¬íŠ¸ í¬ì›Œë”©) â†’ docker0 â†’ veth123
```

```bash
# Bridge ë„¤íŠ¸ì›Œí¬ ìƒì„±
$ docker network create \
  --driver bridge \
  --subnet 172.18.0.0/16 \
  --gateway 172.18.0.1 \
  mynetwork

# ì»¨í…Œì´ë„ˆ ì—°ê²°
$ docker run -d \
  --name web \
  --network mynetwork \
  --ip 172.18.0.10 \
  nginx

# iptables ê·œì¹™ í™•ì¸ (NAT)
$ sudo iptables -t nat -L -n

DOCKER chain:
-A DOCKER -p tcp -m tcp --dport 8080 -j DNAT --to-destination 172.18.0.10:80

POSTROUTING chain:
-A POSTROUTING -s 172.18.0.0/16 -j MASQUERADE
```

#### 2. Host ëª¨ë“œ

```
Host ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Host Network Namespace
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  eth0: 192.168.1.100                        â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Container   â”‚                          â”‚
â”‚  â”‚  (no ns)     â”‚                          â”‚
â”‚  â”‚              â”‚                          â”‚
â”‚  â”‚  ì§ì ‘ eth0   â”‚                          â”‚
â”‚  â”‚  ì‚¬ìš©        â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íŠ¹ì§•:
âœ“ í¬íŠ¸ ë§¤í•‘ ë¶ˆí•„ìš”
âœ“ ìµœê³  ì„±ëŠ¥
âœ— í¬íŠ¸ ì¶©ëŒ ê°€ëŠ¥
âœ— ê²©ë¦¬ ì•½í•¨
```

```bash
# Host ëª¨ë“œ ì‚¬ìš©
$ docker run -d \
  --network host \
  nginx

# ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì˜ 80í¬íŠ¸ ì§ì ‘ ì‚¬ìš©
# localhost:80 â†’ ë°”ë¡œ nginx

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸
$ docker exec <container> ip addr
# â†’ í˜¸ìŠ¤íŠ¸ì™€ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ë³´ì„
```

#### 3. Container ëª¨ë“œ

```bash
# Container1 ì‹¤í–‰
$ docker run -d --name app1 nginx

# Container2ê°€ Container1ì˜ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©
$ docker run -d \
  --network container:app1 \
  --name app2 \
  redis

# app2ëŠ” app1ê³¼ ê°™ì€ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
# localhostë¡œ í†µì‹  ê°€ëŠ¥
```

#### 4. None ëª¨ë“œ

```bash
# ë„¤íŠ¸ì›Œí¬ ì—†ìŒ
$ docker run -d \
  --network none \
  --name isolated \
  alpine

# ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸
$ docker exec isolated ip addr
# â†’ loopbackë§Œ ì¡´ì¬
```

### í¬íŠ¸ í¬ì›Œë”© ìƒì„¸

```bash
# í¬íŠ¸ í¬ì›Œë”© ì„¤ì •
$ docker run -d \
  -p 8080:80 \        # í˜¸ìŠ¤íŠ¸:ì»¨í…Œì´ë„ˆ
  -p 127.0.0.1:8081:80 \  # íŠ¹ì • IPì—ë§Œ ë°”ì¸ë”©
  -p 9000-9010:9000-9010 \  # í¬íŠ¸ ë²”ìœ„
  nginx

# iptables ê·œì¹™ ìƒì„±
Chain DOCKER (1 references)
target     prot opt source               destination
DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 to:172.17.0.2:80
DNAT       tcp  --  127.0.0.1            0.0.0.0/0            tcp dpt:8081 to:172.17.0.2:80
```

```
í¬íŠ¸ í¬ì›Œë”© íë¦„:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

í´ë¼ì´ì–¸íŠ¸ ìš”ì²­:
192.168.1.50:12345 â†’ 192.168.1.100:8080

1. í˜¸ìŠ¤íŠ¸ eth0 ìˆ˜ì‹ 
   dst: 192.168.1.100:8080

2. iptables DNAT ê·œì¹™ ì ìš©
   dst: 172.17.0.2:80  (ì»¨í…Œì´ë„ˆ IP:í¬íŠ¸)

3. docker0 ë¸Œë¦¬ì§€ë¡œ í¬ì›Œë”©

4. veth í†µí•´ ì»¨í…Œì´ë„ˆë¡œ ì „ë‹¬

5. ì»¨í…Œì´ë„ˆ nginxê°€ ìš”ì²­ ì²˜ë¦¬

6. ì‘ë‹µ ì „ì†¡ (ì—­ë°©í–¥)
   src: 172.17.0.2:80

7. iptables SNAT ì ìš©
   src: 192.168.1.100:8080

8. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µ
   â†’ 192.168.1.50:12345
```

### DNS í•´ì„

```bash
# ì»¤ìŠ¤í…€ ë„¤íŠ¸ì›Œí¬ ìƒì„±
$ docker network create myapp

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ docker run -d --name web --network myapp nginx
$ docker run -d --name db --network myapp postgres

# ì»¨í…Œì´ë„ˆ ê°„ DNS í•´ì„
$ docker exec web ping db
PING db (172.18.0.3) 56(84) bytes of data.
64 bytes from db.myapp (172.18.0.3): icmp_seq=1 ttl=64 time=0.045 ms

# /etc/hosts í™•ì¸ (ê¸°ë³¸ bridgeëŠ” DNS ì—†ìŒ)
$ docker exec web cat /etc/resolv.conf
nameserver 127.0.0.11  â† Docker ë‚´ì¥ DNS
```

```
Docker ë‚´ì¥ DNS ë™ì‘:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Container "web"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DNS Query: "db"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
  127.0.0.11:53
  (Docker ë‚´ì¥ DNS)
         â”‚
         â†“
  ì»¨í…Œì´ë„ˆ ì´ë¦„ ì¡°íšŒ
  "db" â†’ 172.18.0.3
         â”‚
         â†“
  IP ì£¼ì†Œ ë°˜í™˜
  172.18.0.3
         â”‚
         â†“
Container "web" â†’ "db" ì—°ê²°
```

---

## ìŠ¤í† ë¦¬ì§€ ë“œë¼ì´ë²„

### ë“œë¼ì´ë²„ ì¢…ë¥˜

```
ìŠ¤í† ë¦¬ì§€ ë“œë¼ì´ë²„ ë¹„êµ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

overlay2 (ê¶Œì¥)
âœ“ ìµœì‹ , ê°€ì¥ ë¹ ë¦„
âœ“ ì»¤ë„ 4.0 ì´ìƒ
âœ“ Production ê¶Œì¥
âœ“ inode íš¨ìœ¨ì 

aufs
âœ“ ì•ˆì •ì 
âœ“ Ubuntu 14.04 ê¸°ë³¸
âœ— êµ¬í˜•

devicemapper
âœ“ RHEL/CentOS 7 ê¸°ë³¸
âœ— ì„¤ì • ë³µì¡
âœ— ì„±ëŠ¥ ë‚®ìŒ

btrfs
âœ“ Copy-on-Write
âœ“ ìŠ¤ëƒ…ìƒ· ë¹ ë¦„
âœ— Production ë¹„ê¶Œì¥

zfs
âœ“ ë†’ì€ ì•ˆì •ì„±
âœ“ ì••ì¶•/ì¤‘ë³µ ì œê±°
âœ— ë©”ëª¨ë¦¬ ë§ì´ ì‚¬ìš©
```

### overlay2 ìƒì„¸

```bash
# í˜„ì¬ ìŠ¤í† ë¦¬ì§€ ë“œë¼ì´ë²„ í™•ì¸
$ docker info | grep Storage
Storage Driver: overlay2

# overlay2 ë””ë ‰í† ë¦¬ êµ¬ì¡°
/var/lib/docker/overlay2/
â”œâ”€â”€ <layer-id-1>/
â”‚   â”œâ”€â”€ diff/           # ì‹¤ì œ íŒŒì¼ ë‚´ìš©
â”‚   â”œâ”€â”€ link            # ì§§ì€ ì‹¬ë³¼ë¦­ ë§í¬
â”‚   â”œâ”€â”€ lower           # í•˜ìœ„ ë ˆì´ì–´ ë§í¬
â”‚   â””â”€â”€ work/           # OverlayFS ì‘ì—… ë””ë ‰í† ë¦¬
â”œâ”€â”€ <layer-id-2>/
â”‚   â”œâ”€â”€ diff/
â”‚   â”œâ”€â”€ link
â”‚   â”œâ”€â”€ lower
â”‚   â””â”€â”€ work/
â””â”€â”€ <container-id>/
    â”œâ”€â”€ diff/           # Upper layer
    â”œâ”€â”€ merged/         # ìµœì¢… ë§ˆìš´íŠ¸ í¬ì¸íŠ¸
    â”œâ”€â”€ lower           # ëª¨ë“  í•˜ìœ„ ë ˆì´ì–´
    â””â”€â”€ work/
```

---

## ì„±ëŠ¥ ìµœì í™”

### ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”

```dockerfile
# âŒ ìµœì•…ì˜ ì˜ˆ (1.2GB)
FROM ubuntu:20.04
RUN apt-get update
RUN apt-get install -y python3
RUN apt-get install -y python3-pip
RUN pip3 install flask
RUN pip3 install requests
COPY . .
CMD ["python3", "app.py"]

# âœ… ìµœì í™” (150MB)
FROM python:3.9-slim        # slim ì´ë¯¸ì§€ ì‚¬ìš©

WORKDIR /app

# ì˜ì¡´ì„± ìºì‹±
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì†ŒìŠ¤ ì½”ë“œ
COPY app.py .

# ë¹„root ì‚¬ìš©ì
RUN useradd -m appuser
USER appuser

CMD ["python", "app.py"]

# ğŸš€ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ (50MB)
FROM python:3.9 AS builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.9-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY app.py .
ENV PATH=/root/.local/bin:$PATH
CMD ["python", "app.py"]
```

### ë¹Œë“œ ìºì‹œ ìµœì í™”

```dockerfile
# âŒ ìºì‹œ í™œìš© ì•ˆ ë¨
COPY . .
RUN npm install

# ì†ŒìŠ¤ ë³€ê²½ ì‹œ npm install ë§¤ë²ˆ ì‹¤í–‰

# âœ… ìºì‹œ í™œìš©
COPY package*.json ./
RUN npm install
COPY . .

# package.json ë³€ê²½ ì‹œì—ë§Œ npm install ì‹¤í–‰
```

### ë ˆì´ì–´ ìˆ˜ ì¤„ì´ê¸°

```dockerfile
# âŒ ë ˆì´ì–´ ë§ìŒ (5ê°œ)
RUN apt-get update
RUN apt-get install -y curl
RUN apt-get install -y wget
RUN apt-get install -y git
RUN rm -rf /var/lib/apt/lists/*

# âœ… ë ˆì´ì–´ ì ìŒ (1ê°œ)
RUN apt-get update && \
    apt-get install -y \
        curl \
        wget \
        git && \
    rm -rf /var/lib/apt/lists/*
```

---

## ë³´ì•ˆ ê°•í™”

### ìµœì†Œ ê¶Œí•œ ì›ì¹™

```dockerfile
# âŒ rootë¡œ ì‹¤í–‰
FROM node:18
COPY . .
CMD ["node", "app.js"]

# âœ… ë¹„root ì‚¬ìš©ì
FROM node:18

# ì‚¬ìš©ì ìƒì„±
RUN groupadd -r nodejs && \
    useradd -r -g nodejs nodejs

WORKDIR /app
COPY --chown=nodejs:nodejs . .

USER nodejs

CMD ["node", "app.js"]
```

### ì½ê¸° ì „ìš© íŒŒì¼ì‹œìŠ¤í…œ

```bash
# ì½ê¸° ì „ìš© ì»¨í…Œì´ë„ˆ
$ docker run -d \
  --read-only \
  --tmpfs /tmp:rw,noexec,nosuid \
  --tmpfs /var/run:rw,noexec,nosuid \
  nginx
```

### Capability ì œí•œ

```bash
# ëª¨ë“  capability ì œê±° í›„ í•„ìš”í•œ ê²ƒë§Œ ì¶”ê°€
$ docker run -d \
  --cap-drop=ALL \
  --cap-add=NET_BIND_SERVICE \
  --cap-add=CHOWN \
  nginx
```

---

## ë‹¤ìŒ í•™ìŠµ

- [Kubernetes ì™„ë²½ ê°€ì´ë“œ](kubernetes-complete-guide.md)
- [Docker ì‹¤ìŠµ í”„ë¡œì íŠ¸](../code-examples/docker-hands-on/README.md)
- [í”„ë¡œë•ì…˜ ë°°í¬ ì „ëµ](production-deployment.md)

---

*Last updated: 2026-01-12*
