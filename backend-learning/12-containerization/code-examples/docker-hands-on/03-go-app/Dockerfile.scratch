# ğŸš€ ìµœì†Œ ì´ë¯¸ì§€ (scratch)

# ==================== Build Stage ====================
FROM golang:1.21-alpine AS builder

WORKDIR /app

# ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ
COPY go.mod go.sum* ./
RUN go mod download

# ì†ŒìŠ¤ ë³µì‚¬
COPY . .

# Static ë°”ì´ë„ˆë¦¬ ë¹Œë“œ
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build \
    -a \
    -installsuffix cgo \
    -ldflags="-w -s" \
    -o main .

# ==================== Runtime Stage ====================
FROM scratch

# CA ì¸ì¦ì„œë§Œ ë³µì‚¬ (HTTPS í†µì‹ ìš©)
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

# ë°”ì´ë„ˆë¦¬ë§Œ ë³µì‚¬
COPY --from=builder /app/main /main

EXPOSE 8080

CMD ["/main"]

# ê²°ê³¼: ì´ë¯¸ì§€ í¬ê¸° ~8MB ğŸš€ (ìµœì†Œ!)
# ì£¼ì˜: shellì´ ì—†ì–´ì„œ execìœ¼ë¡œ ì ‘ì† ë¶ˆê°€
