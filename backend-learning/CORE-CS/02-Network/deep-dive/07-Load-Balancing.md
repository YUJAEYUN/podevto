# Load Balancing - ë¡œë“œ ë°¸ëŸ°ì‹±

> "íŠ¸ë˜í”½ì„ ë¶„ì‚°í•˜ì—¬ ê°€ìš©ì„±ê³¼ ì„±ëŠ¥ í–¥ìƒ"

## ğŸ¯ í•™ìŠµ ëª©í‘œ

- **ë¡œë“œ ë°¸ëŸ°ì‹±ì˜ í•„ìš”ì„±** ì´í•´
- **L4 vs L7 ë¡œë“œ ë°¸ëŸ°ì„œ** ì°¨ì´ íŒŒì•…
- **ë¡œë“œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜** ìƒì„¸ í•™ìŠµ
- **í—¬ìŠ¤ ì²´í¬ì™€ ì„¸ì…˜ ê´€ë¦¬** ë©”ì»¤ë‹ˆì¦˜ ìŠµë“
- **ì‹¤ë¬´ ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì •** ë°©ë²• í•™ìŠµ

## ğŸ“š ë¡œë“œ ë°¸ëŸ°ì‹± ê¸°ì´ˆ

### ë¡œë“œ ë°¸ëŸ°ì‹±ì´ë€?

```
ë‹¨ì¼ ì„œë²„ (ë¬¸ì œ):
í´ë¼ì´ì–¸íŠ¸ 1 â”
í´ë¼ì´ì–¸íŠ¸ 2 â”œâ†’ ì„œë²„ (ê³¼ë¶€í•˜! ğŸ˜±)
í´ë¼ì´ì–¸íŠ¸ 3 â”˜

ë¡œë“œ ë°¸ëŸ°ì‹± (í•´ê²°):
              ë¡œë“œ ë°¸ëŸ°ì„œ
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
í´ë¼ì´ì–¸íŠ¸ 1 â†’ ì„œë²„ 1    ì„œë²„ 2    ì„œë²„ 3
í´ë¼ì´ì–¸íŠ¸ 2 â†’    â†“        â†“        â†“
í´ë¼ì´ì–¸íŠ¸ 3 â†’ íŠ¸ë˜í”½ ë¶„ì‚° âœ…
```

### ì™œ í•„ìš”í•œê°€?

**1. ê°€ìš©ì„± (High Availability)**:
```
ì„œë²„ 1 ë‹¤ìš´ ì‹œ:
ë¡œë“œ ë°¸ëŸ°ì„œê°€ ìë™ìœ¼ë¡œ ì„œë²„ 2, 3ìœ¼ë¡œ íŠ¸ë˜í”½ ì „í™˜
â†’ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì—†ìŒ âœ…
```

**2. í™•ì¥ì„± (Scalability)**:
```
íŠ¸ë˜í”½ ì¦ê°€ ì‹œ:
ì„œë²„ ì¶”ê°€ â†’ ë¡œë“œ ë°¸ëŸ°ì„œ ì„¤ì • â†’ ìë™ ë¶„ì‚°
â†’ ìˆ˜í‰ í™•ì¥ (Scale Out) âœ…
```

**3. ì„±ëŠ¥ (Performance)**:
```
ë‹¨ì¼ ì„œë²„: 1000 req/s (í•œê³„)
3ê°œ ì„œë²„: 3000 req/s (ë¶„ì‚°) âš¡
```

## ğŸ” ë¡œë“œ ë°¸ëŸ°ì„œ ê³„ì¸µ

### L4 Load Balancer (Transport Layer)

**íŠ¹ì§•**:
- OSI 4ê³„ì¸µ (Transport) ì •ë³´ ì‚¬ìš©
- IP ì£¼ì†Œ, Port, Protocol (TCP/UDP) ê¸°ë°˜ ë¶„ì‚°
- ë¹ ë¦„ âš¡
- ì €ë ´

**ë™ì‘**:
```
í´ë¼ì´ì–¸íŠ¸: 192.168.1.10:5000 â†’ LB:80
LB: TCP/IP í—¤ë” í™•ì¸
    - ì¶œë°œì§€: 192.168.1.10:5000
    - ëª©ì ì§€: 10.0.0.1:80 (LB)

LB: ì„œë²„ ì„ íƒ (Round Robin)
    â†’ ì„œë²„ 1 (10.0.1.10:8080)

LB: NAT ìˆ˜í–‰ (IP/Port ë³€ê²½)
    - ì¶œë°œì§€: 10.0.0.1:5000 (LB)
    - ëª©ì ì§€: 10.0.1.10:8080 (ì„œë²„ 1)

ì„œë²„ 1 â† íŒ¨í‚· ì „ë‹¬
```

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ë‹¨ìˆœ TCP/UDP íŠ¸ë˜í”½ ë¶„ì‚°
âœ… ê³ ì„±ëŠ¥ ìš”êµ¬ (ê²Œì„ ì„œë²„, ìŠ¤íŠ¸ë¦¬ë°)
âœ… IP/Port ê¸°ë°˜ ë¼ìš°íŒ…
```

**ì œì•½**:
```
âŒ HTTP í—¤ë” í™•ì¸ ë¶ˆê°€ (Host, URL, Cookie ë“±)
âŒ SSL í„°ë¯¸ë„¤ì´ì…˜ ë¶ˆê°€
âŒ ì½˜í…ì¸  ê¸°ë°˜ ë¼ìš°íŒ… ë¶ˆê°€
```

---

### L7 Load Balancer (Application Layer)

**íŠ¹ì§•**:
- OSI 7ê³„ì¸µ (Application) ì •ë³´ ì‚¬ìš©
- HTTP í—¤ë”, URL, Cookie ê¸°ë°˜ ë¶„ì‚°
- ìœ ì—°í•¨ (ë‹¤ì–‘í•œ ë¼ìš°íŒ… ê·œì¹™)
- ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼ (ë³µì¡í•œ ì²˜ë¦¬)

**ë™ì‘**:
```
í´ë¼ì´ì–¸íŠ¸ â†’ LB:443
LB: TLS í•¸ë“œì…°ì´í¬ (SSL í„°ë¯¸ë„¤ì´ì…˜)
LB: HTTP í—¤ë” íŒŒì‹±
    - Host: api.example.com
    - Path: /users
    - Cookie: session=abc123

LB: ë¼ìš°íŒ… ê·œì¹™ ì ìš©
    - /users â†’ ì„œë²„ 1 (ìœ ì € ì„œë¹„ìŠ¤)
    - /posts â†’ ì„œë²„ 2 (í¬ìŠ¤íŠ¸ ì„œë¹„ìŠ¤)
    - /images â†’ ì„œë²„ 3 (ì´ë¯¸ì§€ ì„œë²„)

LB â†’ ì„œë²„ 1:8080 (HTTP ì „ë‹¬)
ì„œë²„ 1: ìš”ì²­ ì²˜ë¦¬ â†’ ì‘ë‹µ
LB: TLS ì•”í˜¸í™” â†’ í´ë¼ì´ì–¸íŠ¸
```

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¼ìš°íŒ… (URL ê¸°ë°˜)
âœ… A/B í…ŒìŠ¤íŠ¸ (Cookie/Header ê¸°ë°˜)
âœ… ìºì‹± (ì •ì  ì½˜í…ì¸  ìºì‹œ)
âœ… SSL í„°ë¯¸ë„¤ì´ì…˜
âœ… WAF (ì›¹ ë°©í™”ë²½) í†µí•©
```

---

### L4 vs L7 ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature         â”‚ L4 (TCP/IP)  â”‚ L7 (HTTP)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì²˜ë¦¬ ì†ë„       â”‚ ë¹ ë¦„ âš¡      â”‚ ìƒëŒ€ì  ëŠë¦¼  â”‚
â”‚ ë¼ìš°íŒ… ê¸°ì¤€     â”‚ IP, Port     â”‚ URL, Header  â”‚
â”‚ SSL í„°ë¯¸ë„¤ì´ì…˜  â”‚ âŒ           â”‚ âœ…           â”‚
â”‚ ì½˜í…ì¸  ê¸°ë°˜     â”‚ âŒ           â”‚ âœ…           â”‚
â”‚ ì„¸ì…˜ ìœ ì§€       â”‚ Source IP    â”‚ Cookie       â”‚
â”‚ ë¹„ìš©            â”‚ ì €ë ´         â”‚ ë¹„ì‹¸         â”‚
â”‚ ì‚¬ìš© ì‚¬ë¡€       â”‚ TCP/UDP ì „ë°˜ â”‚ HTTP/HTTPS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ë¡œë“œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜

### 1. Round Robin (ë¼ìš´ë“œ ë¡œë¹ˆ)

**ë™ì‘**:
```
ì„œë²„: [ì„œë²„ 1, ì„œë²„ 2, ì„œë²„ 3]

ìš”ì²­ 1 â†’ ì„œë²„ 1
ìš”ì²­ 2 â†’ ì„œë²„ 2
ìš”ì²­ 3 â†’ ì„œë²„ 3
ìš”ì²­ 4 â†’ ì„œë²„ 1 (ìˆœí™˜)
ìš”ì²­ 5 â†’ ì„œë²„ 2
...
```

**ì¥ì **:
- ë‹¨ìˆœí•˜ê³  ê³µí‰
- ì„œë²„ ì„±ëŠ¥ì´ ë™ì¼í•  ë•Œ íš¨ê³¼ì 

**ë‹¨ì **:
- ì„œë²„ ì„±ëŠ¥ ì°¨ì´ ë¬´ì‹œ
- ì„¸ì…˜ ìœ ì§€ ì–´ë ¤ì›€

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ë™ì¼ ì‚¬ì–‘ ì„œë²„
âœ… Stateless ì• í”Œë¦¬ì¼€ì´ì…˜
```

---

### 2. Weighted Round Robin (ê°€ì¤‘ ë¼ìš´ë“œ ë¡œë¹ˆ)

**ë™ì‘**:
```
ì„œë²„ 1: ê°€ì¤‘ì¹˜ 5 (ê³ ì„±ëŠ¥)
ì„œë²„ 2: ê°€ì¤‘ì¹˜ 3 (ì¤‘ì„±ëŠ¥)
ì„œë²„ 3: ê°€ì¤‘ì¹˜ 2 (ì €ì„±ëŠ¥)

ìš”ì²­ ë¶„ë°°:
ì„œë²„ 1: 50% (5 / 10)
ì„œë²„ 2: 30% (3 / 10)
ì„œë²„ 3: 20% (2 / 10)
```

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ì„œë²„ ì„±ëŠ¥ ì°¨ì´ ìˆìŒ
âœ… ì‹ ê·œ ì„œë²„ í…ŒìŠ¤íŠ¸ (ë‚®ì€ ê°€ì¤‘ì¹˜ë¡œ ì‹œì‘)
```

---

### 3. Least Connections (ìµœì†Œ ì—°ê²°)

**ë™ì‘**:
```
í˜„ì¬ ìƒíƒœ:
ì„œë²„ 1: 5ê°œ ì—°ê²°
ì„œë²„ 2: 8ê°œ ì—°ê²°
ì„œë²„ 3: 3ê°œ ì—°ê²° â† ì„ íƒ!

ìƒˆ ìš”ì²­ â†’ ì„œë²„ 3 (ì—°ê²° ìˆ˜ ê°€ì¥ ì ìŒ)
```

**ì¥ì **:
- ë™ì ìœ¼ë¡œ ë¶€í•˜ ë¶„ì‚°
- ì¥ê¸° ì—°ê²° (WebSocket, ìŠ¤íŠ¸ë¦¬ë°)ì— íš¨ê³¼ì 

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… WebSocket
âœ… ì¥ê¸° HTTP Keep-Alive
âœ… ìš”ì²­ ì²˜ë¦¬ ì‹œê°„ ì°¨ì´ í¼
```

---

### 4. Weighted Least Connections (ê°€ì¤‘ ìµœì†Œ ì—°ê²°)

**ë™ì‘**:
```
ì„œë²„ 1: 10ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 5 â†’ ë¹„ìœ¨ 2.0 (10/5)
ì„œë²„ 2: 6ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 3  â†’ ë¹„ìœ¨ 2.0 (6/3)
ì„œë²„ 3: 4ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 2  â†’ ë¹„ìœ¨ 2.0 (4/2)

ëª¨ë‘ ë™ì¼ ë¹„ìœ¨ â†’ Round Robinìœ¼ë¡œ ì„ íƒ

ì„œë²„ 1: 12ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 5 â†’ ë¹„ìœ¨ 2.4 (12/5)
ì„œë²„ 2: 6ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 3  â†’ ë¹„ìœ¨ 2.0 (6/3) â† ì„ íƒ!
ì„œë²„ 3: 4ê°œ ì—°ê²°, ê°€ì¤‘ì¹˜ 2  â†’ ë¹„ìœ¨ 2.0 (4/2)
```

---

### 5. IP Hash (IP í•´ì‹œ)

**ë™ì‘**:
```
í´ë¼ì´ì–¸íŠ¸ IPë¥¼ í•´ì‹±í•˜ì—¬ ì„œë²„ ì„ íƒ

hash(192.168.1.10) % 3 = 1 â†’ ì„œë²„ 2
hash(192.168.1.11) % 3 = 0 â†’ ì„œë²„ 1
hash(192.168.1.12) % 3 = 2 â†’ ì„œë²„ 3

ê°™ì€ í´ë¼ì´ì–¸íŠ¸ëŠ” í•­ìƒ ê°™ì€ ì„œë²„ë¡œ! âœ…
```

**ì¥ì **:
- ì„¸ì…˜ ìœ ì§€ (Sticky Session)
- ìºì‹œ íš¨ìœ¨ (í´ë¼ì´ì–¸íŠ¸ë³„ ìºì‹œ)

**ë‹¨ì **:
- ì„œë²„ ì¶”ê°€/ì œê±° ì‹œ í•´ì‹œ ì¬ë¶„ë°°
- ë¶€í•˜ ë¶ˆê· í˜• ê°€ëŠ¥ (íŠ¹ì • IP ì§‘ì¤‘)

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ì„¸ì…˜ ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜
âœ… ë¡œì»¬ ìºì‹œ ì‚¬ìš©
```

---

### 6. Least Response Time (ìµœì†Œ ì‘ë‹µ ì‹œê°„)

**ë™ì‘**:
```
ì„œë²„ 1: í‰ê·  ì‘ë‹µ 100ms, 5ê°œ ì—°ê²°
ì„œë²„ 2: í‰ê·  ì‘ë‹µ 50ms, 8ê°œ ì—°ê²° â† ì„ íƒ!
ì„œë²„ 3: í‰ê·  ì‘ë‹µ 200ms, 3ê°œ ì—°ê²°

ì‘ë‹µ ì‹œê°„ + ì—°ê²° ìˆ˜ ê³ ë ¤
```

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ì„±ëŠ¥ ìµœì í™” ì¤‘ìš”
âœ… ì„œë²„ ì‘ë‹µ ì‹œê°„ ì°¨ì´ í¼
```

---

### 7. Random (ëœë¤)

**ë™ì‘**:
```
ë¬´ì‘ìœ„ë¡œ ì„œë²„ ì„ íƒ

ìš”ì²­ 1 â†’ ì„œë²„ 2
ìš”ì²­ 2 â†’ ì„œë²„ 1
ìš”ì²­ 3 â†’ ì„œë²„ 2
ìš”ì²­ 4 â†’ ì„œë²„ 3
```

**ì¥ì **:
- êµ¬í˜„ ë‹¨ìˆœ
- ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì—ì„œ í‰ê· ì ìœ¼ë¡œ ê· ë“± ë¶„ì‚°

**ì‚¬ìš© ì‚¬ë¡€**:
```
âœ… ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸
âœ… Stateless ì• í”Œë¦¬ì¼€ì´ì…˜
```

---

## ğŸ©º í—¬ìŠ¤ ì²´í¬ (Health Check)

### Active Health Check (ëŠ¥ë™ì  í—¬ìŠ¤ ì²´í¬)

**ë™ì‘**:
```
ë¡œë“œ ë°¸ëŸ°ì„œê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ ìƒíƒœ í™•ì¸

ë§¤ 5ì´ˆë§ˆë‹¤:
LB â†’ GET /health â†’ ì„œë²„ 1
ì„œë²„ 1 â†’ 200 OK âœ…

LB â†’ GET /health â†’ ì„œë²„ 2
ì„œë²„ 2 â†’ (ì‘ë‹µ ì—†ìŒ) âŒ

LB: ì„œë²„ 2ë¥¼ ëª©ë¡ì—ì„œ ì œê±°
íŠ¸ë˜í”½ â†’ ì„œë²„ 1, ì„œë²„ 3ë§Œ ì‚¬ìš©
```

**ì„¤ì • ì˜ˆì‹œ (Nginx)**:
```nginx
upstream backend {
    server 10.0.1.10:8080;
    server 10.0.1.11:8080;
    server 10.0.1.12:8080;

    # í—¬ìŠ¤ ì²´í¬
    check interval=3000 rise=2 fall=3 timeout=1000 type=http;
    check_http_send "GET /health HTTP/1.0\r\n\r\n";
    check_http_expect_alive http_2xx http_3xx;
}
```

**íŒŒë¼ë¯¸í„°**:
```
interval: 3000ms (3ì´ˆë§ˆë‹¤ ì²´í¬)
rise: 2 (2íšŒ ì„±ê³µ ì‹œ ì •ìƒ)
fall: 3 (3íšŒ ì‹¤íŒ¨ ì‹œ ë¹„ì •ìƒ)
timeout: 1000ms (ì‘ë‹µ ëŒ€ê¸° ì‹œê°„)
```

---

### Passive Health Check (ìˆ˜ë™ì  í—¬ìŠ¤ ì²´í¬)

**ë™ì‘**:
```
ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ì„±ê³µ/ì‹¤íŒ¨ë¡œ íŒë‹¨

í´ë¼ì´ì–¸íŠ¸ 1 â†’ ì„œë²„ 2 â†’ 500 Error âŒ
í´ë¼ì´ì–¸íŠ¸ 2 â†’ ì„œë²„ 2 â†’ 502 Error âŒ
í´ë¼ì´ì–¸íŠ¸ 3 â†’ ì„œë²„ 2 â†’ Timeout âŒ

LB: ì„œë²„ 2ê°€ 3íšŒ ì—°ì† ì‹¤íŒ¨ â†’ ì œê±°
```

**ì¥ì **:
- ì¶”ê°€ íŠ¸ë˜í”½ ì—†ìŒ
- ì‹¤ì œ ìš”ì²­ ê¸°ë°˜ íŒë‹¨

**ë‹¨ì **:
- ì‹¤íŒ¨ ê°ì§€ ëŠë¦¼ (í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ìˆì„ ë•Œë§Œ)

---

### Health Check Endpoint

**êµ¬í˜„ ì˜ˆì‹œ (Node.js)**:
```javascript
// Express
app.get('/health', (req, res) => {
  // 1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
  const dbOk = await checkDatabase();

  // 2. ì™¸ë¶€ API ì—°ê²° í™•ì¸
  const apiOk = await checkExternalAPI();

  // 3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
  const memOk = process.memoryUsage().heapUsed < 500 * 1024 * 1024; // 500MB

  if (dbOk && apiOk && memOk) {
    res.status(200).json({ status: 'healthy' });
  } else {
    res.status(503).json({
      status: 'unhealthy',
      db: dbOk,
      api: apiOk,
      memory: memOk
    });
  }
});
```

---

## ğŸ” ì„¸ì…˜ ìœ ì§€ (Session Persistence)

### ë¬¸ì œ ìƒí™©

```
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 1: ë¡œê·¸ì¸ (ì„¸ì…˜ ìƒì„±)
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 2: ìš”ì²­ (ì„¸ì…˜ ì—†ìŒ!) ğŸ˜±
â†’ ë‹¤ì‹œ ë¡œê·¸ì¸ ìš”êµ¬
```

### í•´ê²° ë°©ë²•

#### 1. Sticky Session (Cookie ê¸°ë°˜)

**ë™ì‘**:
```
1. í´ë¼ì´ì–¸íŠ¸ â†’ LB â†’ ì„œë²„ 1
2. LB: Set-Cookie: SERVER=server1
3. í´ë¼ì´ì–¸íŠ¸: Cookie ì €ì¥
4. ì´í›„ ìš”ì²­: Cookie: SERVER=server1 â†’ í•­ìƒ ì„œë²„ 1ë¡œ âœ…
```

**ì„¤ì • (Nginx)**:
```nginx
upstream backend {
    ip_hash;  # IP í•´ì‹œë¡œ Sticky Session
    server 10.0.1.10:8080;
    server 10.0.1.11:8080;
}
```

**ë‹¨ì **:
```
âŒ ì„œë²„ ë‹¤ìš´ ì‹œ ì„¸ì…˜ ì†ì‹¤
âŒ ë¶€í•˜ ë¶ˆê· í˜• (íŠ¹ì • ì„œë²„ ì§‘ì¤‘)
```

---

#### 2. Shared Session Store (ì¤‘ì•™ ì„¸ì…˜ ì €ì¥ì†Œ)

**ë™ì‘**:
```
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 1: ë¡œê·¸ì¸
ì„œë²„ 1: ì„¸ì…˜ì„ Redisì— ì €ì¥

í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 2: ìš”ì²­
ì„œë²„ 2: Redisì—ì„œ ì„¸ì…˜ ì¡°íšŒ âœ…

ëª¨ë“  ì„œë²„ê°€ ê°™ì€ ì„¸ì…˜ ê³µìœ !
```

**êµ¬í˜„ (Node.js + Redis)**:
```javascript
const session = require('express-session');
const RedisStore = require('connect-redis')(session);
const redis = require('redis');

const redisClient = redis.createClient({
  host: 'redis.example.com',
  port: 6379
});

app.use(session({
  store: new RedisStore({ client: redisClient }),
  secret: 'secret-key',
  resave: false,
  saveUninitialized: false,
  cookie: { maxAge: 3600000 } // 1ì‹œê°„
}));
```

**ì¥ì **:
```
âœ… ì„œë²„ ë‹¤ìš´í•´ë„ ì„¸ì…˜ ìœ ì§€
âœ… ë¶€í•˜ ê· ë“± ë¶„ì‚° ê°€ëŠ¥
âœ… ìˆ˜í‰ í™•ì¥ ìš©ì´
```

**ë‹¨ì **:
```
âŒ Redis ì¥ì•  ì‹œ ì „ì²´ ì˜í–¥
âŒ ë„¤íŠ¸ì›Œí¬ ì§€ì—° (Redis ì¡°íšŒ)
```

---

#### 3. JWT (JSON Web Token)

**ë™ì‘**:
```
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 1: ë¡œê·¸ì¸
ì„œë²„ 1: JWT ìƒì„± (ì„œëª…) â†’ í´ë¼ì´ì–¸íŠ¸

í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ 2: JWT ì „ì†¡
ì„œë²„ 2: JWT ê²€ì¦ (ì„œëª… í™•ì¸) âœ…

ì„œë²„ì— ì„¸ì…˜ ì €ì¥ ë¶ˆí•„ìš”!
```

**ì¥ì **:
```
âœ… Stateless (ì„œë²„ ë¶€ë‹´ ì—†ìŒ)
âœ… í™•ì¥ ìš©ì´
âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì í•©
```

**ë‹¨ì **:
```
âŒ í† í° í¬ê¸° í¼ (ë§¤ ìš”ì²­ ì „ì†¡)
âŒ í† í° ë¬´íš¨í™” ì–´ë ¤ì›€
```

---

## ğŸ› ï¸ ì‹¤ë¬´ ë¡œë“œ ë°¸ëŸ°ì„œ

### Nginx (L7)

**ì„¤ì •**:
```nginx
http {
    upstream backend {
        least_conn;  # ì•Œê³ ë¦¬ì¦˜: Least Connections

        server 10.0.1.10:8080 weight=5 max_fails=3 fail_timeout=30s;
        server 10.0.1.11:8080 weight=3;
        server 10.0.1.12:8080 weight=2;

        # ë°±ì—… ì„œë²„ (ë‹¤ë¥¸ ì„œë²„ ëª¨ë‘ ë‹¤ìš´ ì‹œ)
        server 10.0.1.20:8080 backup;

        # í—¬ìŠ¤ ì²´í¬
        check interval=3000 rise=2 fall=3 timeout=1000;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://backend;

            # í—¤ë” ì „ë‹¬
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # íƒ€ì„ì•„ì›ƒ
            proxy_connect_timeout 5s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }
    }
}
```

**URL ê¸°ë°˜ ë¼ìš°íŒ…**:
```nginx
location /api {
    proxy_pass http://api_backend;
}

location /static {
    proxy_pass http://static_backend;
}

location /ws {
    proxy_pass http://websocket_backend;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

---

### HAProxy (L4/L7)

**ì„¤ì •**:
```haproxy
global
    maxconn 4096
    log /dev/log local0

defaults
    mode http
    timeout connect 5s
    timeout client 50s
    timeout server 50s

frontend http_front
    bind *:80
    default_backend http_back

backend http_back
    balance roundrobin  # ì•Œê³ ë¦¬ì¦˜

    # í—¬ìŠ¤ ì²´í¬
    option httpchk GET /health

    server server1 10.0.1.10:8080 check weight 5
    server server2 10.0.1.11:8080 check weight 3
    server server3 10.0.1.12:8080 check weight 2

    # Sticky Session
    cookie SERVERID insert indirect nocache

# L4 ëª¨ë“œ (TCP)
frontend tcp_front
    bind *:3306
    mode tcp
    default_backend mysql_back

backend mysql_back
    mode tcp
    balance leastconn
    server db1 10.0.2.10:3306 check
    server db2 10.0.2.11:3306 check
```

---

### AWS ELB (Elastic Load Balancer)

**ì¢…ë¥˜**:
```
1. ALB (Application Load Balancer) - L7
   - HTTP/HTTPS
   - URL ê¸°ë°˜ ë¼ìš°íŒ…
   - WebSocket ì§€ì›

2. NLB (Network Load Balancer) - L4
   - TCP/UDP
   - ì´ˆê³ ì„±ëŠ¥ (ìˆ˜ë°±ë§Œ req/s)
   - ê³ ì • IP ì œê³µ

3. CLB (Classic Load Balancer) - L4/L7
   - ë ˆê±°ì‹œ (ì‚¬ìš© ê¶Œì¥ ì•ˆ í•¨)
```

**ALB ì„¤ì • (Terraform)**:
```hcl
resource "aws_lb" "main" {
  name               = "main-alb"
  internal           = false
  load_balancer_type = "application"
  subnets            = aws_subnet.public[*].id

  enable_http2       = true
  enable_cross_zone_load_balancing = true
}

resource "aws_lb_target_group" "app" {
  name     = "app-tg"
  port     = 8080
  protocol = "HTTP"
  vpc_id   = aws_vpc.main.id

  health_check {
    path                = "/health"
    interval            = 30
    timeout             = 5
    healthy_threshold   = 2
    unhealthy_threshold = 3
  }
}

resource "aws_lb_listener" "http" {
  load_balancer_arn = aws_lb.main.arn
  port              = "80"
  protocol          = "HTTP"

  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.app.arn
  }
}

resource "aws_lb_listener_rule" "api" {
  listener_arn = aws_lb_listener.http.arn
  priority     = 100

  action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.api.arn
  }

  condition {
    path_pattern {
      values = ["/api/*"]
    }
  }
}
```

---

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] L4ì™€ L7 ë¡œë“œ ë°¸ëŸ°ì„œì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] Round Robin, Least Connections, IP Hash ì•Œê³ ë¦¬ì¦˜ì„ ì´í•´í•œë‹¤
- [ ] Active/Passive Health Checkì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì•ˆë‹¤
- [ ] Sticky Sessionì˜ ì¥ë‹¨ì ì„ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] Nginx/HAProxyë¡œ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤
- [ ] ì„¸ì…˜ ê´€ë¦¬ ì „ëµ (Redis, JWT)ì„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤

## ğŸ”— ë‹¤ìŒ í•™ìŠµ

- [08-WebSocket-gRPC.md](./08-WebSocket-gRPC.md) - ì‹¤ì‹œê°„ í†µì‹ 
- [06-DNS-Deep-Dive.md](./06-DNS-Deep-Dive.md) - DNSì™€ ë¡œë“œ ë°¸ëŸ°ì‹±

---

**"ë¡œë“œ ë°¸ëŸ°ì„œëŠ” ê°€ìš©ì„±ì˜ í•µì‹¬. ë‹¨ì¼ ì¥ì•  ì§€ì ì„ ì œê±°í•˜ë¼."**
