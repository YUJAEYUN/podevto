# TCP Flow Control - íë¦„ ì œì–´

> "ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìì˜ ì†ë„ ì¡°ì ˆ"

## ğŸ¯ í•™ìŠµ ëª©í‘œ

- **íë¦„ ì œì–´ì˜ í•„ìš”ì„±** ì´í•´
- **ìŠ¬ë¼ì´ë”© ìœˆë„ìš°** ë™ì‘ ì›ë¦¬ íŒŒì•…
- **Window Size** ì¡°ì ˆ ë©”ì»¤ë‹ˆì¦˜ ì´í•´

## ğŸ¤” ì™œ íë¦„ ì œì–´ê°€ í•„ìš”í•œê°€?

### ë¬¸ì œ ìƒí™©

```
ì†¡ì‹ ì: ì´ˆë‹¹ 100MB ì „ì†¡ âš¡
ìˆ˜ì‹ ì: ì´ˆë‹¹ 10MB ì²˜ë¦¬ ğŸŒ

â†’ ìˆ˜ì‹ ìì˜ ë²„í¼ ì˜¤ë²„í”Œë¡œ!
â†’ íŒ¨í‚· ì†ì‹¤ ë°œìƒ
```

### í•´ê²°: íë¦„ ì œì–´

```
ìˆ˜ì‹ ìê°€ ì†¡ì‹ ìì—ê²Œ "ì²œì²œíˆ ë³´ë‚´!" ì•Œë¦¼
â†’ ì†¡ì‹ ìê°€ ì „ì†¡ ì†ë„ ì¡°ì ˆ
â†’ íŒ¨í‚· ì†ì‹¤ ë°©ì§€ âœ…
```

## ğŸ“š ìŠ¬ë¼ì´ë”© ìœˆë„ìš° (Sliding Window)

### ê°œë…

ìˆ˜ì‹ ìê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ë°ì´í„° ì–‘ì„ **Window Size**ë¡œ ì•Œë¦¼

```
Window Size = 4 (4ê°œ íŒ¨í‚·ê¹Œì§€ ë™ì‹œ ì „ì†¡ ê°€ëŠ¥)

ì†¡ì‹ ì:
[1] [2] [3] [4] â† ì „ì†¡ ê°€ëŠ¥
        â†“
[2] [3] [4] [5] â† 1ë²ˆ ACK ë°›ìœ¼ë©´ ìœˆë„ìš° ì´ë™
```

### ë™ì‘ ê³¼ì •

```
Step 1: ì´ˆê¸° ìƒíƒœ
ì†¡ì‹ : [1][2][3][4] --- Window Size: 4
ìˆ˜ì‹ : ëŒ€ê¸°

Step 2: 1,2,3,4 ì „ì†¡
ì†¡ì‹ : [1][2][3][4] ì „ì†¡ë¨
ìˆ˜ì‹ : [1][2][3][4] ìˆ˜ì‹  ì¤‘...

Step 3: ACK 1 ìˆ˜ì‹ 
ì†¡ì‹ : [2][3][4][5] --- ìœˆë„ìš° ì´ë™!
ìˆ˜ì‹ : ACK 1 ì „ì†¡

Step 4: ACK 2 ìˆ˜ì‹ 
ì†¡ì‹ : [3][4][5][6] --- ìœˆë„ìš° ì´ë™!
ìˆ˜ì‹ : ACK 2 ì „ì†¡
```

## ğŸ’¡ Window Size ì¡°ì ˆ

### ìˆ˜ì‹ ìì˜ ë²„í¼ ìƒíƒœ

```
ë²„í¼ í¬ê¸°: 10,000 bytes
í˜„ì¬ ë°ì´í„°: 6,000 bytes
ë‚¨ì€ ê³µê°„: 4,000 bytes

â†’ Window Size = 4,000 bytes
â†’ ACKì— í¬í•¨í•˜ì—¬ ì „ì†¡
```

### Window Size ê°ì†Œ

```
ìˆ˜ì‹ ì ë²„í¼ê°€ ê°€ë“ ì°¸:
Window Size: 4000 â†’ 2000 â†’ 1000 â†’ 0

Window Size = 0:
â†’ ì†¡ì‹ ìëŠ” ì „ì†¡ ì¤‘ì§€
â†’ ìˆ˜ì‹ ìê°€ ë²„í¼ë¥¼ ë¹„ìš¸ ë•Œê¹Œì§€ ëŒ€ê¸°
```

### Window Size ì¦ê°€

```
ìˆ˜ì‹ ìê°€ ë°ì´í„° ì²˜ë¦¬:
Window Size: 0 â†’ 1000 â†’ 2000 â†’ 4000

â†’ ì†¡ì‹ ìëŠ” ë‹¤ì‹œ ì „ì†¡ ì‹œì‘
```

## ğŸ” TCP í—¤ë”ì˜ Window Size

```
TCP í—¤ë”:
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Window Size (16ë¹„íŠ¸)          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

ìµœëŒ€ê°’: 65535 bytes (64KB)
```

### Window Scaling (RFC 1323)

```
Window Sizeê°€ ì‘ì€ ë¬¸ì œ í•´ê²°

Scaling Factor: 0~14
ì‹¤ì œ Window Size = Window Size Ã— 2^Scaling Factor

ì˜ˆ:
Window Size = 65535
Scaling Factor = 4
ì‹¤ì œ í¬ê¸° = 65535 Ã— 2^4 = 1,048,560 bytes (1MB)
```

## ğŸ“Š ì‹¤ì œ ì˜ˆì œ

### ì •ìƒ ë™ì‘

```
ì‹œê°„ 0: ì†¡ì‹ ìê°€ 1~4 ì „ì†¡ (Window Size=4)
ì‹œê°„ 1: ìˆ˜ì‹ ìê°€ ACK 1 ì „ì†¡ (Window Size=4)
ì‹œê°„ 2: ì†¡ì‹ ìê°€ ìœˆë„ìš° ì´ë™ [2][3][4][5]
ì‹œê°„ 3: ì†¡ì‹ ìê°€ 5 ì „ì†¡
```

### ë²„í¼ ë¶€ì¡±

```
ì‹œê°„ 0: ì†¡ì‹ ìê°€ 1~4 ì „ì†¡ (Window Size=4)
ì‹œê°„ 1: ìˆ˜ì‹ ìê°€ ACK 1 ì „ì†¡ (Window Size=2) â† ê°ì†Œ!
ì‹œê°„ 2: ì†¡ì‹ ìê°€ 5, 6ë§Œ ì „ì†¡ (ìœˆë„ìš° í¬ê¸° ì œí•œ)
ì‹œê°„ 3: ìˆ˜ì‹ ìê°€ ACK 2 ì „ì†¡ (Window Size=0) â† 0!
ì‹œê°„ 4: ì†¡ì‹ ìëŠ” ì „ì†¡ ì¤‘ì§€
```

### Zero Window íšŒë³µ

```
ì‹œê°„ 4: Window Size = 0, ì†¡ì‹ ì ëŒ€ê¸°
ì‹œê°„ 5: ìˆ˜ì‹ ìê°€ ë°ì´í„° ì²˜ë¦¬
ì‹œê°„ 6: ìˆ˜ì‹ ìê°€ Window Update ì „ì†¡ (Window Size=2)
ì‹œê°„ 7: ì†¡ì‹ ìê°€ ë‹¤ì‹œ ì „ì†¡ ì‹œì‘
```

## ğŸ¯ íë¦„ ì œì–´ vs í˜¼ì¡ ì œì–´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚ íë¦„ ì œì–´    â”‚ í˜¼ì¡ ì œì–´    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ëª©ì             â”‚ ìˆ˜ì‹ ì ë³´í˜¸  â”‚ ë„¤íŠ¸ì›Œí¬ ë³´í˜¸â”‚
â”‚ ì œì–´ ëŒ€ìƒ       â”‚ ìˆ˜ì‹  ì†ë„    â”‚ ì „ì†¡ ì†ë„    â”‚
â”‚ ê¸°ì¤€            â”‚ Window Size  â”‚ cwnd         â”‚
â”‚ ê²°ì •ì          â”‚ ìˆ˜ì‹ ì       â”‚ ì†¡ì‹ ì       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» ì‹¤ìŠµ

### Window Size í™•ì¸

```bash
# TCP ì—°ê²°ì˜ Window Size í™•ì¸
netstat -tan

# ê²°ê³¼:
Recv-Q Send-Q Local Address    Foreign Address  State
0      0      192.168.1.10:50  93.184.216.34:80 ESTABLISHED
```

### tcpdumpë¡œ Window Size í™•ì¸

```bash
sudo tcpdump -i any -nn 'tcp port 80'

# ê²°ê³¼:
IP 192.168.1.10.5000 > 93.184.216.34.80: Flags [S], 
  seq 1000, win 65535, ...
  #          ^^^^^^^^^ Window Size
```

## ğŸ”— ë‹¤ìŒ í•™ìŠµ

- [03-TCP-Congestion-Control.md](./03-TCP-Congestion-Control.md)

---

**"íë¦„ ì œì–´ëŠ” ìˆ˜ì‹ ìë¥¼ ìœ„í•œ ë°°ë ¤"**
