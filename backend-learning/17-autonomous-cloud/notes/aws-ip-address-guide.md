# AWS IP 주소 완벽 가이드

> Public IP, Elastic IP, Private IP - 언제 무엇을 써야 하나?

## 목차
1. [IP 주소 종류와 차이점](#ip-주소-종류와-차이점)
2. [Private IP 완벽 이해](#private-ip-완벽-이해)
3. [Public IP 완벽 이해](#public-ip-완벽-이해)
4. [Elastic IP 완벽 이해](#elastic-ip-완벽-이해)
5. [실전 시나리오와 선택 기준](#실전-시나리오와-선택-기준)
6. [비용 최적화 전략](#비용-최적화-전략)

---

## IP 주소 종류와 차이점

### AWS에서 사용하는 3가지 IP

```
┌─────────────────────────────────────────────────────────────┐
│                        AWS IP 종류                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1️⃣ Private IP (사설 IP)                                   │
│     • VPC 내부 통신용                                        │
│     • 인터넷 접근 불가 (직접)                                │
│     • 모든 EC2가 기본으로 가짐                               │
│     • 인스턴스 종료 전까지 유지                              │
│     • 비용: 무료                                            │
│                                                             │
│  2️⃣ Public IP (동적 공인 IP)                               │
│     • 인터넷 통신용                                         │
│     • 인스턴스 시작/중지마다 변경됨                          │
│     • Public Subnet에서만 할당 가능                         │
│     • 비용: 무료 (단, 2024년부터 사용하면 무료)              │
│                                                             │
│  3️⃣ Elastic IP (고정 공인 IP)                              │
│     • 인터넷 통신용                                         │
│     • 변경되지 않는 고정 IP                                 │
│     • 계정에 할당 후 EC2에 연결                             │
│     • 비용: 사용 중이면 무료, 미사용 시 시간당 과금 💰       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 한눈에 비교

| 특성 | Private IP | Public IP | Elastic IP |
|------|-----------|-----------|------------|
| **고정 여부** | 고정 (인스턴스 종료까지) | 변동 (재시작마다) | 완전 고정 |
| **인터넷 접근** | ❌ 불가 (NAT 필요) | ✅ 가능 | ✅ 가능 |
| **VPC 내부 통신** | ✅ 사용 | ❌ 사용 안 함 | ❌ 사용 안 함 |
| **할당 시점** | 인스턴스 생성 시 | 인스턴스 시작 시 | 수동 할당 |
| **해제 시점** | 인스턴스 종료 시 | 인스턴스 중지/종료 시 | 수동 해제 |
| **비용** | 무료 | 무료 (사용 중) | 사용: 무료<br>미사용: $0.005/시간 |
| **개수 제한** | 서브넷 CIDR 따라 | 인스턴스당 1개 | 리전당 5개 (증설 가능) |

---

## Private IP 완벽 이해

### Private IP란?

```
VPC 내부에서만 사용 가능한 IP 주소

RFC 1918 표준 사설 IP 대역:
• 10.0.0.0 ~ 10.255.255.255 (10.0.0.0/8)
• 172.16.0.0 ~ 172.31.255.255 (172.16.0.0/12)
• 192.168.0.0 ~ 192.168.255.255 (192.168.0.0/16)

AWS VPC 예시:
VPC: 10.0.0.0/16
├─ Subnet 1: 10.0.1.0/24 (10.0.1.0 ~ 10.0.1.255)
├─ Subnet 2: 10.0.2.0/24 (10.0.2.0 ~ 10.0.2.255)
└─ Subnet 3: 10.0.3.0/24 (10.0.3.0 ~ 10.0.3.255)
```

### Private IP 할당 방식

```
EC2 인스턴스 생성 시 자동 할당

┌────────────────────────────────────────────────┐
│ Subnet: 10.0.1.0/24                            │
│                                                │
│ 사용 가능한 IP: 10.0.1.0 ~ 10.0.1.255 (256개)  │
│                                                │
│ ⚠️  AWS 예약 IP (5개, 사용 불가):              │
│ • 10.0.1.0   - 네트워크 주소                   │
│ • 10.0.1.1   - VPC 라우터                      │
│ • 10.0.1.2   - DNS 서버                        │
│ • 10.0.1.3   - 미래 사용 예약                  │
│ • 10.0.1.255 - 브로드캐스트                    │
│                                                │
│ 실제 사용 가능: 256 - 5 = 251개                │
│ (10.0.1.4 ~ 10.0.1.254)                        │
│                                                │
│ EC2 생성 시:                                   │
│ • 자동: 10.0.1.4부터 순서대로 할당             │
│ • 수동: 10.0.1.100 같이 직접 지정 가능         │
└────────────────────────────────────────────────┘
```

### Private IP 동작 방식

```
시나리오: VPC 내부 통신

┌──────────────────────────────────────────┐
│ Web Server (10.0.1.10)                   │
│      │                                   │
│      │ SQL 쿼리 전송                      │
│      │ Src: 10.0.1.10                    │
│      │ Dst: 10.0.2.20                    │
│      │                                   │
│      ▼                                   │
└──────┼──────────────────────────────────┘
       │
       │ VPC 내부 라우팅 (라우팅 테이블: local)
       │ IGW/NAT 거치지 않음!
       │
       ▼
┌──────┼──────────────────────────────────┐
│      ▼                                   │
│ RDS (10.0.2.20)                          │
│ ✅ Private IP로 직접 통신                │
└──────────────────────────────────────────┘

💡 핵심: Private IP는 VPC 내부에서만 유효
   인터넷에서는 이 IP로 접근 불가!
```

### Private IP 사용 사례

```
✅ RDS, ElastiCache 같은 데이터베이스
   → 외부 접근 차단, VPC 내부에서만 접근

✅ Private Subnet의 애플리케이션 서버
   → ALB 뒤에 숨어있고, 직접 접근 불필요

✅ Lambda (VPC 연결 시)
   → RDS 접근 위해 Private Subnet에 ENI 생성

✅ 내부 서비스 (Kafka, Elasticsearch 등)
   → 외부 노출 불필요한 인프라
```

---

## Public IP 완벽 이해

### Public IP란?

```
인터넷에서 접근 가능한 동적 공인 IP

특징:
• 인스턴스 시작할 때 AWS가 자동 할당
• 인스턴스 중지하면 반납됨
• 다시 시작하면 새로운 IP 할당
• Public Subnet에서만 활성화 가능
```

### Public IP 할당 조건

```
Public IP를 받으려면 3가지 조건 충족:

1️⃣ Public Subnet에 위치
   └─ 라우팅 테이블에 "0.0.0.0/0 → IGW" 있어야 함

2️⃣ "Auto-assign Public IP" 설정 활성화
   └─ 서브넷 설정 또는 인스턴스 생성 시 선택

3️⃣ 인스턴스 상태가 "running"
   └─ 중지(stopped)하면 Public IP 반납

┌────────────────────────────────────────────────┐
│ EC2 인스턴스 생성 시 옵션:                     │
│                                                │
│ [ ] Auto-assign Public IP                     │
│     • Enable: Public IP 자동 할당              │
│     • Disable: Private IP만 할당               │
│     • Use subnet setting: 서브넷 설정 따름     │
└────────────────────────────────────────────────┘
```

### Public IP 동작 방식 (IGW와의 관계)

```
중요: Public IP는 EC2 내부에서 보이지 않음!
     IGW가 1:1 NAT로 변환해줌

사용자 (211.234.123.45) → 웹서버 접속

1️⃣ 사용자 → Internet Gateway
   ┌────────────────────────────────────────┐
   │ 출발지: 211.234.123.45                 │
   │ 목적지: 3.35.100.50 (EC2의 Public IP)  │
   └────────────────────────────────────────┘

2️⃣ Internet Gateway가 주소 변환
   ┌────────────────────────────────────────┐
   │ IGW 내부 매핑 테이블:                  │
   │ 3.35.100.50 (Public) ↔ 10.0.1.10 (Private) │
   │                                        │
   │ 목적지 변경:                           │
   │ 3.35.100.50 → 10.0.1.10                │
   └────────────────────────────────────────┘

3️⃣ EC2가 받은 패킷
   ┌────────────────────────────────────────┐
   │ 출발지: 211.234.123.45                 │
   │ 목적지: 10.0.1.10 ← Private IP!        │
   │                                        │
   │ ⚠️  EC2 내부에서 ifconfig 실행하면     │
   │    10.0.1.10만 보임 (Public IP 안 보임)│
   └────────────────────────────────────────┘

4️⃣ 응답 (반대 방향도 IGW가 변환)
   ┌────────────────────────────────────────┐
   │ EC2 → IGW                              │
   │ 출발지: 10.0.1.10 (Private)            │
   │                                        │
   │ IGW → 인터넷                           │
   │ 출발지: 3.35.100.50 (Public)           │
   └────────────────────────────────────────┘
```

### Public IP 확인 방법

```bash
# EC2 인스턴스 내부에서 확인

# 1️⃣ Private IP 확인 (로컬)
ifconfig
# 또는
ip addr show

# 출력:
# eth0: 10.0.1.10 ← Private IP만 보임

# 2️⃣ Public IP 확인 (외부 서비스 이용)
curl https://checkip.amazonaws.com
# 출력: 3.35.100.50 ← Public IP

# 또는
curl https://ifconfig.me
curl https://api.ipify.org

# 3️⃣ EC2 메타데이터로 확인
curl http://169.254.169.254/latest/meta-data/public-ipv4
# 출력: 3.35.100.50

curl http://169.254.169.254/latest/meta-data/local-ipv4
# 출력: 10.0.1.10
```

### Public IP의 한계

```
❌ 문제 1: 인스턴스 재시작하면 IP 변경
   ┌────────────────────────────────────────┐
   │ 시작: 3.35.100.50                      │
   │ 중지 → 시작: 3.35.101.78 (변경됨!)     │
   └────────────────────────────────────────┘
   → DNS 설정 또는 설정 파일 업데이트 필요

❌ 문제 2: 중지 상태에서 IP 없음
   ┌────────────────────────────────────────┐
   │ Running: 3.35.100.50 있음              │
   │ Stopped: IP 없음 (반납됨)              │
   └────────────────────────────────────────┘
   → 개발 중 중지했다가 다시 시작하면 연결 끊김

❌ 문제 3: Auto Scaling에 부적합
   → 새 인스턴스마다 IP 바뀜

✅ 해결책: Elastic IP 또는 Load Balancer 사용
```

---

## Elastic IP 완벽 이해

### Elastic IP란?

```
AWS 계정에 할당되는 고정 공인 IP

특징:
• 완전히 고정 (변경 안 됨)
• 계정이 소유 (인스턴스와 독립적)
• 다른 인스턴스에 재연결 가능
• 리전별로 관리 (서울 리전, 도쿄 리전 등 별도)
```

### Elastic IP 동작 방식

```
┌─────────────────────────────────────────────────────────┐
│                   Elastic IP 라이프사이클                │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1️⃣ 할당 (Allocate)                                    │
│  ┌──────────────────────────────────────────────┐      │
│  │ AWS가 풀에서 IP 할당                         │      │
│  │ 예: 3.35.50.100                              │      │
│  │ → 당신의 계정에 영구 할당됨                  │      │
│  │ → 비용: $0.005/시간 ($3.6/월) 💰            │      │
│  └──────────────────────────────────────────────┘      │
│           │                                             │
│           ▼                                             │
│  2️⃣ 연결 (Associate)                                   │
│  ┌──────────────────────────────────────────────┐      │
│  │ EC2 인스턴스에 연결                          │      │
│  │ • 기존 Public IP는 자동 제거됨               │      │
│  │ • Elastic IP가 새로운 Public IP가 됨         │      │
│  │ → 비용: 무료 (사용 중이므로) ✅              │      │
│  └──────────────────────────────────────────────┘      │
│           │                                             │
│           ▼                                             │
│  3️⃣ 사용 (In Use)                                      │
│  ┌──────────────────────────────────────────────┐      │
│  │ 인스턴스 중지/시작해도 IP 유지 ✅            │      │
│  │ 인스턴스 종료 후 다른 인스턴스에 재연결 가능 │      │
│  └──────────────────────────────────────────────┘      │
│           │                                             │
│           ▼                                             │
│  4️⃣ 연결 해제 (Disassociate)                           │
│  ┌──────────────────────────────────────────────┐      │
│  │ EC2에서 분리                                 │      │
│  │ → 비용: $0.005/시간 다시 발생 💰            │      │
│  └──────────────────────────────────────────────┘      │
│           │                                             │
│           ▼                                             │
│  5️⃣ 해제 (Release)                                     │
│  ┌──────────────────────────────────────────────┐      │
│  │ IP를 AWS 풀에 반납                           │      │
│  │ → 비용: 무료 ✅                              │      │
│  │ ⚠️  한 번 Release하면 같은 IP 다시 못 받음   │      │
│  └──────────────────────────────────────────────┘      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### Elastic IP 비용 구조

```
┌─────────────────────────────────────────────────────┐
│              Elastic IP 비용 정책                   │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ✅ 무료 (과금 안 됨):                              │
│  • Running 인스턴스에 연결되어 사용 중              │
│  • 인스턴스당 1개의 EIP만 연결                      │
│                                                     │
│  💰 과금 ($0.005/시간 = $3.6/월):                  │
│  • Elastic IP를 할당만 하고 연결 안 함              │
│  • Stopped 인스턴스에 연결되어 있음                 │
│  • 인스턴스에 2개 이상의 EIP 연결                   │
│                                                     │
│  📊 실제 사례:                                      │
│                                                     │
│  사례 1: 프로덕션 서버                              │
│  ┌────────────────────────────────────┐            │
│  │ EC2 (running) + EIP 1개            │            │
│  │ → 비용: $0 ✅                      │            │
│  └────────────────────────────────────┘            │
│                                                     │
│  사례 2: 개발 서버 (밤에 중지)                      │
│  ┌────────────────────────────────────┐            │
│  │ EC2 (stopped) + EIP 유지           │            │
│  │ → 비용: $0.005 × 12시간 = $0.06/일 │            │
│  │         월 $1.8 💰                 │            │
│  └────────────────────────────────────┘            │
│                                                     │
│  사례 3: EIP만 할당하고 방치                        │
│  ┌────────────────────────────────────┐            │
│  │ EIP만 보유, 인스턴스 연결 안 함    │            │
│  │ → 비용: $0.005 × 24시간 × 30일     │            │
│  │         = $3.6/월 💰💰             │            │
│  └────────────────────────────────────┘            │
│                                                     │
└─────────────────────────────────────────────────────┘

⚠️  주의: 사용 안 하는 EIP는 즉시 Release!
```

### Elastic IP 장단점

```
✅ 장점:

1️⃣ 고정 IP
   • 인스턴스 재시작해도 IP 유지
   • DNS A 레코드 한 번만 설정
   • 설정 파일에 하드코딩 가능

2️⃣ 빠른 장애 복구
   ┌────────────────────────────────────────┐
   │ 운영 서버 (EC2-A) 장애 발생!           │
   │      │                                 │
   │      ▼                                 │
   │ EIP 연결 해제 (1초)                    │
   │      │                                 │
   │      ▼                                 │
   │ 백업 서버 (EC2-B)에 EIP 재연결 (1초)   │
   │      │                                 │
   │      ▼                                 │
   │ 사용자는 같은 IP로 접속 ✅             │
   │ DNS 변경 없이 즉시 복구!               │
   └────────────────────────────────────────┘

3️⃣ 유연한 관리
   • 테스트 서버 ↔ 운영 서버 IP 교체 가능
   • 마이그레이션 시 다운타임 최소화

❌ 단점:

1️⃣ 비용 발생 가능
   • 인스턴스 중지하면 과금
   • 미사용 EIP 방치 시 낭비

2️⃣ 수동 관리 필요
   • Auto Scaling과 호환 안 됨
   • 장애 시 수동으로 재연결

3️⃣ 개수 제한
   • 리전당 5개 (증설 가능하지만 심사)
   • 너무 많이 신청하면 AWS가 거부 가능
```

### Elastic IP 실습

```bash
# AWS CLI로 Elastic IP 관리

# 1️⃣ Elastic IP 할당
aws ec2 allocate-address --domain vpc --region ap-northeast-2

# 출력:
# {
#   "AllocationId": "eipalloc-0abcd1234",
#   "PublicIp": "3.35.50.100",
#   "Domain": "vpc"
# }

# 2️⃣ EC2 인스턴스에 연결
aws ec2 associate-address \
  --instance-id i-1234567890abcdef0 \
  --allocation-id eipalloc-0abcd1234

# 3️⃣ 현재 할당된 EIP 목록 조회
aws ec2 describe-addresses

# 4️⃣ 연결 해제
aws ec2 disassociate-address \
  --association-id eipassoc-xyz789

# 5️⃣ EIP 해제 (반납)
aws ec2 release-address \
  --allocation-id eipalloc-0abcd1234

# ⚠️  Release 전 반드시 Disassociate 먼저!
```

---

## 실전 시나리오와 선택 기준

### 시나리오 1: 개인 블로그 (소규모)

```
요구사항:
• 트래픽 적음 (하루 100명)
• 비용 최소화 중요
• 가끔 인스턴스 중지 (비용 절감)

❌ Elastic IP 사용 시:
┌────────────────────────────────────────┐
│ EC2 (t3.micro): $7.5/월                │
│ EIP (중지 시간): $1.8/월 💰            │
│ 합계: $9.3/월                          │
└────────────────────────────────────────┘

✅ Public IP + Route 53 사용 시:
┌────────────────────────────────────────┐
│ EC2 (t3.micro): $7.5/월                │
│ Route 53 (Hosted Zone): $0.5/월        │
│ 합계: $8/월 ✅                         │
│                                        │
│ 방법: IP 바뀌면 Route 53 A 레코드 업데이트 │
│ (스크립트 자동화 가능)                 │
└────────────────────────────────────────┘

추천: Public IP + 자동화 스크립트
```

### 시나리오 2: API 서버 (중소규모)

```
요구사항:
• 외부 서비스와 IP 기반 연동 (화이트리스트)
• 24/7 운영 (중지 안 함)
• 고정 IP 필수

✅ Elastic IP 사용:
┌────────────────────────────────────────┐
│ EC2 (t3.small): $15/월                 │
│ EIP (Running 연결): $0/월 ✅           │
│ 합계: $15/월                           │
│                                        │
│ • IP 고정으로 파트너사 화이트리스트 등록│
│ • 장애 시 백업 인스턴스로 EIP 이동     │
└────────────────────────────────────────┘

추천: Elastic IP
```

### 시나리오 3: 웹 애플리케이션 (대규모)

```
요구사항:
• Auto Scaling 사용
• 트래픽 변동 큼
• 고가용성 중요

❌ Elastic IP:
• Auto Scaling으로 생성된 인스턴스에 EIP 자동 할당 불가
• 수동 관리 필요

✅ Application Load Balancer 사용:
┌────────────────────────────────────────┐
│ ALB: $16.2/월 (0.0225/시간)            │
│ • 고정 DNS 이름 제공                   │
│ • Auto Scaling 완벽 지원               │
│ • Health Check 자동 장애 복구          │
│ • SSL 종료, Path 기반 라우팅           │
│                                        │
│ EC2 인스턴스들:                        │
│ • Private IP만 사용                    │
│ • Public IP/EIP 불필요                 │
└────────────────────────────────────────┘

추천: ALB + Private Subnet
```

### 시나리오 4: 개발/테스트 환경

```
요구사항:
• 여러 개발자가 접속
• 밤에는 중지 (비용 절감)
• IP가 바뀌어도 괜찮음 (개발용)

✅ Public IP 사용:
┌────────────────────────────────────────┐
│ EC2 (t3.medium): $30/월                │
│ 중지 시간 (12시간): $15/월             │
│ 합계: $15/월 ✅                        │
│                                        │
│ • 시작할 때마다 Slack에 IP 전송        │
│ • 또는 Session Manager로 접속          │
└────────────────────────────────────────┘

추천: Public IP (비용 절감)
```

### 선택 플로우차트

```
┌─────────────────────────────────────┐
│ EC2에 인터넷 접근 필요?              │
└──────────────┬──────────────────────┘
               │
        ┌──────┴──────┐
        │ No          │ Yes
        ▼             ▼
┌───────────────┐  ┌──────────────────────┐
│ Private IP만  │  │ Auto Scaling 사용?   │
│ (내부 서버용) │  └──────┬───────────────┘
└───────────────┘         │
                   ┌──────┴──────┐
                   │ Yes         │ No
                   ▼             ▼
         ┌─────────────────┐  ┌────────────────┐
         │ ALB + Private IP│  │ 고정 IP 필요?  │
         │ (추천!)         │  └────────┬───────┘
         └─────────────────┘           │
                                ┌──────┴──────┐
                                │ Yes         │ No
                                ▼             ▼
                      ┌──────────────┐  ┌────────────┐
                      │ Elastic IP   │  │ Public IP  │
                      │ ($0, 운영 중)│  │ (무료)     │
                      └──────────────┘  └────────────┘
```

---

## 비용 최적화 전략

### 전략 1: 사용하지 않는 Elastic IP 정리

```bash
# 🔍 미사용 EIP 찾기 스크립트

aws ec2 describe-addresses \
  --query 'Addresses[?AssociationId==null].[PublicIp,AllocationId]' \
  --output table

# 출력 예시:
# ┌────────────────────┬─────────────────────┐
# │ 3.35.50.100        │ eipalloc-0abc123    │ ← 미사용!
# │ 3.35.50.101        │ eipalloc-0def456    │ ← 미사용!
# └────────────────────┴─────────────────────┘

# 💰 월 비용: 2개 × $3.6 = $7.2/월 낭비!

# ✅ 해제
aws ec2 release-address --allocation-id eipalloc-0abc123
aws ec2 release-address --allocation-id eipalloc-0def456
```

### 전략 2: 개발 환경은 Public IP 사용

```
개발 환경 구성:

❌ 기존 (EIP 사용):
┌────────────────────────────────────────┐
│ Dev EC2 (stopped 12h/day)              │
│ • EIP 비용: $1.8/월 💰                 │
│                                        │
│ 연간: $1.8 × 12 = $21.6                │
└────────────────────────────────────────┘

✅ 개선 (Public IP + 자동화):
┌────────────────────────────────────────┐
│ Dev EC2 + Public IP                    │
│ • IP 변경 시 Slack 알림 자동화         │
│ • 또는 Session Manager 사용            │
│ • 비용: $0 ✅                          │
└────────────────────────────────────────┘

#!/bin/bash
# 인스턴스 시작 시 실행 (User Data)
PUBLIC_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)
curl -X POST https://hooks.slack.com/... \
  -d '{"text":"Dev server started: '"$PUBLIC_IP"'"}'
```

### 전략 3: ALB로 EIP 대체

```
운영 환경 구성:

❌ 기존 (EIP × 3):
┌────────────────────────────────────────┐
│ EC2-1 + EIP: $0                        │
│ EC2-2 + EIP: $0                        │
│ EC2-3 + EIP: $0                        │
│ DNS Round-robin                        │
│                                        │
│ 문제:                                  │
│ • Health Check 없음                    │
│ • 수동 장애 복구                       │
│ • Auto Scaling 불가                    │
└────────────────────────────────────────┘

✅ 개선 (ALB + Private):
┌────────────────────────────────────────┐
│ ALB: $16.2/월                          │
│ ├─ EC2-1 (Private IP)                  │
│ ├─ EC2-2 (Private IP)                  │
│ └─ EC2-3 (Private IP)                  │
│                                        │
│ 장점:                                  │
│ • 자동 Health Check                    │
│ • Auto Scaling 완벽 지원               │
│ • SSL 종료 (서버 부담 감소)            │
│ • 고정 DNS (EIP 불필요!)               │
└────────────────────────────────────────┘

비용은 약간 올라가지만 기능 대폭 향상 ✅
```

### 전략 4: Elastic IP 재사용

```
시나리오: Blue-Green 배포

❌ 기존 (EIP 2개 사용):
┌────────────────────────────────────────┐
│ Blue 환경: EIP-1                       │
│ Green 환경: EIP-2                      │
│                                        │
│ 배포 시:                               │
│ 1. Green 환경 구축 (EIP-2 사용)        │
│ 2. 테스트                              │
│ 3. DNS를 EIP-2로 변경                  │
│ 4. Blue 환경 제거 (EIP-1 Release)      │
│                                        │
│ 낭비: EIP-2를 계속 보유 (다음 배포 대기)│
└────────────────────────────────────────┘

✅ 개선 (EIP 1개 재사용):
┌────────────────────────────────────────┐
│ 배포 시:                               │
│ 1. Green 환경 구축 (Public IP 사용)    │
│ 2. 테스트                              │
│ 3. Blue에서 EIP Disassociate           │
│ 4. Green에 EIP Associate               │
│ 5. Blue 환경 제거                      │
│                                        │
│ EIP 1개만 유지 → 비용 절감 ✅          │
└────────────────────────────────────────┘
```

### 전략 5: CloudWatch 알람으로 미사용 감지

```python
# Lambda: 미사용 EIP 감지 및 Slack 알림

import boto3
import json
import urllib3

def lambda_handler(event, context):
    ec2 = boto3.client('ec2')
    http = urllib3.PoolManager()

    # 모든 EIP 조회
    addresses = ec2.describe_addresses()

    unused = []
    for addr in addresses['Addresses']:
        # AssociationId 없으면 미사용
        if 'AssociationId' not in addr:
            unused.append(addr['PublicIp'])

    if unused:
        cost_per_month = len(unused) * 3.6
        message = {
            "text": f"⚠️ 미사용 Elastic IP {len(unused)}개 발견!\n" +
                    f"월 ${cost_per_month:.2f} 낭비 중\n" +
                    f"IP: {', '.join(unused)}"
        }

        http.request(
            'POST',
            'https://hooks.slack.com/...',
            body=json.dumps(message),
            headers={'Content-Type': 'application/json'}
        )

    return {'statusCode': 200}

# EventBridge로 매일 실행
# cron(0 9 * * ? *)  # 매일 오전 9시
```

---

## 핵심 정리

### 🎯 5가지 핵심 원칙

```
1️⃣ Private IP는 모든 인스턴스가 기본으로 가짐
   • VPC 내부 통신용
   • 비용 무료

2️⃣ Public IP는 동적, 재시작하면 변경됨
   • 개발 환경에 적합
   • 비용 무료

3️⃣ Elastic IP는 고정, 하지만 비용 주의
   • 운영 중이면 무료
   • 미사용 시 $3.6/월 과금

4️⃣ 대규모 서비스는 ALB 사용
   • Elastic IP 대신 고정 DNS
   • Auto Scaling 지원
   • Health Check 자동화

5️⃣ 미사용 Elastic IP는 즉시 해제
   • 정기적으로 점검
   • CloudWatch 알람 설정
```

### 🧠 이해도 자가 테스트

```
Q1: EC2에서 ifconfig 실행 시 Public IP가 안 보이는 이유는?
A1: IGW가 NAT 변환해주기 때문. EC2는 Private IP만 알고 있음.

Q2: Elastic IP를 할당만 하고 인스턴스에 연결 안 하면?
A2: 시간당 $0.005 과금 ($3.6/월). 즉시 Release 필요!

Q3: 인스턴스 중지 후 다시 시작, Public IP는?
A3: 새로운 IP로 변경됨. Elastic IP는 유지됨.

Q4: Auto Scaling 사용 시 Elastic IP를 쓸 수 있나?
A4: ❌ 불가능. ALB + Private IP 또는 NAT Gateway 사용.

Q5: 리전당 Elastic IP 개수 제한은?
A5: 기본 5개. 증설 가능하지만 AWS 심사 필요.
```

---

## 다음 단계

이제 IP 주소를 완벽히 이해했으니:

1. **ALB (Application Load Balancer)**: Elastic IP 없이 고정 엔드포인트
2. **NAT Gateway**: Private Subnet이 Elastic IP로 나가는 방법
3. **VPC Endpoint**: Public IP 없이 AWS 서비스 접근

다음 가이드에서 계속됩니다!

---

*마지막 업데이트: 2026-01-13*
